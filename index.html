<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProHospitalar - Sistema ERP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .active-tab{background:linear-gradient(135deg,#059669,#047857);color:white}
        .card-hover:hover{transform:translateY(-3px);box-shadow:0 15px 35px rgba(0,0,0,0.1);transition:all 0.3s}
        @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .fade-in{animation:fadeIn 0.6s ease-out}
        .gradient-bg{background:linear-gradient(135deg,#059669 0%,#047857 100%)}
        .shadow-premium{box-shadow:0 25px 50px -12px rgba(0,0,0,0.25)}
        .btn-export{background:linear-gradient(135deg,#10b981,#059669);transition:all 0.3s}
        .btn-export:hover{background:linear-gradient(135deg,#059669,#047857);transform:translateY(-2px)}
        .notification-badge{position:absolute;top:-5px;right:-5px;background:#ef4444;color:white;border-radius:50%;width:20px;height:20px;font-size:12px;display:flex;align-items:center;justify-content:center;font-weight:bold}
        .status-online{width:8px;height:8px;background:#10b981;border-radius:50%;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
        *{margin:0;padding:0;box-sizing:border-box}
        .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.6)}
        .modal-content{background-color:white;margin:2% auto;padding:0;border-radius:15px;width:90%;max-width:900px;max-height:90vh;overflow-y:auto;box-shadow:0 25px 50px rgba(0,0,0,0.3)}
        .modal-header{background:linear-gradient(135deg,#059669,#047857);color:white;padding:20px;border-radius:15px 15px 0 0}
        .modal-body{padding:25px}
        .close{color:white;float:right;font-size:28px;font-weight:bold;cursor:pointer}
        .close:hover{opacity:0.8}
        input,select,textarea{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:8px;margin-top:5px}
        input:focus,select:focus,textarea:focus{outline:none;border-color:#059669}
        label{font-weight:600;color:#374151;margin-top:12px;display:block}
        .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px}
        .btn-add{background:#10b981;color:white;padding:8px 16px;border-radius:6px;border:none;cursor:pointer;font-weight:600}
        .btn-add:hover{background:#059669}
        .btn-remove{background:#ef4444;color:white;padding:4px 12px;border-radius:4px;border:none;cursor:pointer;font-size:12px}
        .btn-remove:hover{background:#dc2626}
        .btn-edit{background:#3b82f6;color:white;padding:6px 12px;border-radius:6px;border:none;cursor:pointer;font-size:12px;font-weight:600;margin-right:5px}
        .btn-edit:hover{background:#2563eb}
        .btn-delete{background:#ef4444;color:white;padding:6px 12px;border-radius:6px;border:none;cursor:pointer;font-size:12px;font-weight:600}
        .btn-delete:hover{background:#dc2626}
        .btn-action{padding:10px 20px;border-radius:8px;border:none;cursor:pointer;font-weight:600;font-size:14px;transition:all 0.3s}
        .btn-print{background:#3b82f6;color:white}
        .btn-print:hover{background:#2563eb;transform:translateY(-2px)}
        .btn-pdf{background:#ef4444;color:white}
        .btn-pdf:hover{background:#dc2626;transform:translateY(-2px)}
        .btn-email{background:#8b5cf6;color:white}
        .btn-email:hover{background:#7c3aed;transform:translateY(-2px)}
        .btn-whatsapp{background:#25d366;color:white}
        .btn-whatsapp:hover{background:#20ba5a;transform:translateY(-2px)}
        .btn-pagar{background:#10b981;color:white;padding:6px 12px;border-radius:6px;border:none;cursor:pointer;font-size:12px;font-weight:600;margin-right:5px}
        .btn-pagar:hover{background:#059669}
        .alerta-estoque{background:#fef3c7;border-left:4px solid #f59e0b;padding:10px;border-radius:6px;margin:10px 0}
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <header class="gradient-bg text-white shadow-2xl">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center text-2xl">ğŸ¥</div>
                    <div>
                        <h1 class="text-2xl font-bold">ProHospitalar</h1>
                        <p class="text-green-100 text-sm">Sistema ERP - GestÃ£o Empresarial</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <button onclick="mostrarNotificacoes()" class="p-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all relative">
                        ğŸ””<div class="notification-badge" id="alert-count">0</div>
                    </button>
                    <button onclick="fazerBackupManual()" class="p-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all" title="Backup Manual">ğŸ’¾</button>
                    <div class="flex items-center space-x-2">
                        <div class="status-online"></div>
                        <span class="text-sm text-green-100">Online</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="text-right">
                            <p class="text-sm font-medium">Admin ProHospitalar</p>
                            <p class="text-xs text-green-100">Conectado</p>
                        </div>
                        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">ğŸ‘¨â€ğŸ’¼</div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="flex">
        <div class="w-80 bg-white shadow-2xl min-h-screen">
            <nav class="mt-6">
                <div class="px-4 space-y-1">
                    <button onclick="showTab('dashboard')" id="tab-dashboard" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all active-tab">
                        <span class="text-xl">ğŸ“Š</span><div class="flex-1 text-left"><span class="font-medium">Dashboard</span></div>
                    </button>
                    <button onclick="showTab('vendas')" id="tab-vendas" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">ğŸ’°</span><div class="flex-1 text-left"><span class="font-medium">Vendas</span></div>
                    </button>
                    <button onclick="showTab('contas-receber')" id="tab-contas-receber" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">ğŸ’µ</span><div class="flex-1 text-left"><span class="font-medium">Contas a Receber</span></div><div class="notification-badge" id="receber-count">0</div>
                    </button>
                    <button onclick="showTab('clientes')" id="tab-clientes" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">ğŸ¥</span><div class="flex-1 text-left"><span class="font-medium">Clientes</span></div>
                    </button>
                    <button onclick="showTab('estoque')" id="tab-estoque" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">ğŸ©º</span><div class="flex-1 text-left"><span class="font-medium">Produtos</span></div><div class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded font-medium" id="estoque-baixo">0</div>
                    </button>
                    <button onclick="showTab('vendedores')" id="tab-vendedores" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">ğŸ‘¨â€ğŸ’¼</span><div class="flex-1 text-left"><span class="font-medium">Representantes</span></div>
                    </button>
                    <button onclick="showTab('fornecedores')" id="tab-fornecedores" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">ğŸ­</span><div class="flex-1 text-left"><span class="font-medium">Fornecedores</span></div>
                    </button>
                    <button onclick="showTab('historico-davs')" id="tab-historico-davs" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">ğŸ“„</span><div class="flex-1 text-left"><span class="font-medium">HistÃ³rico DAVs</span></div>
                    </button>
                </div>
                <div class="mt-8 px-4">
                    <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wide mb-3">AÃ§Ãµes RÃ¡pidas</h3>
                    <div class="space-y-2">
                        <button onclick="openModal('venda')" class="w-full bg-green-50 text-green-700 px-3 py-2 rounded-lg text-sm hover:bg-green-100 font-medium">â• Nova Venda</button>
                        <button onclick="openModal('produto')" class="w-full bg-blue-50 text-blue-700 px-3 py-2 rounded-lg text-sm hover:bg-blue-100 font-medium">ğŸ©º Novo Produto</button>
                        <button onclick="openModal('cliente')" class="w-full bg-purple-50 text-purple-700 px-3 py-2 rounded-lg text-sm hover:bg-purple-100 font-medium">ğŸ¥ Novo Cliente</button>
                        <button onclick="openModal('dav')" class="w-full bg-orange-50 text-orange-700 px-3 py-2 rounded-lg text-sm hover:bg-orange-100 font-medium">ğŸ“„ Gerar DAV</button>
                    </div>
                </div>
                <div class="mt-8 mx-4 p-4 bg-green-50 rounded-xl border border-green-200">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2"><span class="text-2xl">ğŸ’¾</span></div>
                        <h4 class="font-bold text-green-800">Backup AutomÃ¡tico</h4>
                        <p class="text-xs text-green-600 mt-1">Dados salvos automaticamente</p>
                        <p class="text-xs text-green-500 mt-2 font-medium" id="ultimo-backup">Nunca</p>
                    </div>
                </div>
            </nav>
        </div>
        <div class="flex-1 p-8 overflow-y-auto" style="max-height:calc(100vh - 80px)">
            <div id="dashboard" class="fade-in">
                <div class="flex justify-between items-center mb-8">
                    <div><h2 class="text-3xl font-bold text-gray-900">Dashboard ProHospitalar</h2><p class="text-gray-600 mt-1">GestÃ£o completa de equipamentos mÃ©dico-hospitalares</p></div>
                    <button onclick="exportarDashboard()" class="btn-export text-white px-6 py-3 rounded-lg flex items-center space-x-2 shadow-lg"><span>ğŸ“Š</span><span>Exportar</span></button>
                </div>
                <div id="alertas-dashboard"></div>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-green-500 to-emerald-600 p-6 rounded-2xl text-white card-hover shadow-premium"><h3 class="text-green-100 text-sm mb-1">Vendas do MÃªs</h3><p class="text-3xl font-bold" id="dash-vendas">R$ 0</p></div>
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-2xl text-white card-hover shadow-premium"><h3 class="text-blue-100 text-sm mb-1">A Receber</h3><p class="text-3xl font-bold" id="dash-receber">R$ 0</p></div>
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-6 rounded-2xl text-white card-hover shadow-premium"><h3 class="text-purple-100 text-sm mb-1">Clientes</h3><p class="text-3xl font-bold" id="dash-clientes">0</p></div>
                    <div class="bg-gradient-to-br from-orange-500 to-red-500 p-6 rounded-2xl text-white card-hover shadow-premium"><h3 class="text-orange-100 text-sm mb-1">Produtos</h3><p class="text-3xl font-bold" id="dash-produtos">0</p></div>
                    <div class="bg-gradient-to-br from-indigo-500 to-purple-600 p-6 rounded-2xl text-white card-hover shadow-premium"><h3 class="text-indigo-100 text-sm mb-1">Estoque Baixo</h3><p class="text-3xl font-bold" id="dash-estoque-baixo">0</p></div>
                </div>
                <div class="bg-white p-8 rounded-2xl shadow-premium mb-8"><h3 class="text-xl font-bold text-gray-900 mb-6">ğŸ“Š Vendas</h3><canvas id="chartVendasCategorias"></canvas></div>
            </div>
            <div id="vendas" class="hidden">
                <div class="flex justify-between items-center mb-8"><h2 class="text-3xl font-bold text-gray-900">ğŸ’° Vendas</h2><button onclick="exportarVendas()" class="btn-export text-white px-6 py-3 rounded-lg shadow-lg">ğŸ“„ Exportar</button></div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Produto</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">AÃ§Ãµes</th></tr></thead><tbody id="lista-vendas"></tbody></table></div>
            </div>
            <div id="contas-receber" class="hidden">
                <div class="flex justify-between items-center mb-8"><h2 class="text-3xl font-bold text-gray-900">ğŸ’µ Contas a Receber</h2><button onclick="exportarContasReceber()" class="btn-export text-white px-6 py-3 rounded-lg shadow-lg">ğŸ“„ Exportar</button></div>
                <div class="grid grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-premium"><h3 class="text-gray-600 text-sm mb-2">Total a Receber</h3><p class="text-3xl font-bold text-orange-600" id="total-receber">R$ 0</p></div>
                    <div class="bg-white p-6 rounded-xl shadow-premium"><h3 class="text-gray-600 text-sm mb-2">Vencidas</h3><p class="text-3xl font-bold text-red-600" id="total-vencidas">R$ 0</p></div>
                    <div class="bg-white p-6 rounded-xl shadow-premium"><h3 class="text-gray-600 text-sm mb-2">Recebido</h3><p class="text-3xl font-bold text-green-600" id="total-recebido">R$ 0</p></div>
                </div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Venda</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Vencimento</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">AÃ§Ãµes</th></tr></thead><tbody id="lista-contas-receber"></tbody></table></div>
            </div>
            <div id="clientes" class="hidden">
                <div class="flex justify-between items-center mb-8"><h2 class="text-3xl font-bold text-gray-900">ğŸ¥ Clientes</h2><button onclick="exportarClientes()" class="btn-export text-white px-6 py-3 rounded-lg shadow-lg">ğŸ“„ Exportar</button></div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">CNPJ</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cidade</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">AÃ§Ãµes</th></tr></thead><tbody id="lista-clientes"></tbody></table></div>
            </div>
            <div id="estoque" class="hidden">
                <div class="flex justify-between items-center mb-8"><h2 class="text-3xl font-bold text-gray-900">ğŸ©º Produtos</h2><button onclick="exportarProdutos()" class="btn-export text-white px-6 py-3 rounded-lg shadow-lg">ğŸ“„ Exportar</button></div>
                <div id="alerta-estoque-baixo"></div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">CÃ³digo</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Produto</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Quantidade</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">PreÃ§o</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">AÃ§Ãµes</th></tr></thead><tbody id="lista-produtos"></tbody></table></div>
            </div>
            <div id="vendedores" class="hidden">
                <div class="flex justify-between items-center mb-8"><h2 class="text-3xl font-bold text-gray-900">ğŸ‘¨â€ğŸ’¼ Representantes</h2></div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">RegiÃ£o</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Vendas</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">AÃ§Ãµes</th></tr></thead><tbody id="lista-representantes"></tbody></table></div>
            </div>
            <div id="fornecedores" class="hidden">
                <div class="flex justify-between items-center mb-8"><h2 class="text-3xl font-bold text-gray-900">ğŸ­ Fornecedores</h2></div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">CNPJ</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Especialidade</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">AÃ§Ãµes</th></tr></thead><tbody id="lista-fornecedores"></tbody></table></div>
            </div>
            <div id="historico-davs" class="hidden">
                <div class="flex justify-between items-center mb-8"><h2 class="text-3xl font-bold text-gray-900">ğŸ“„ HistÃ³rico DAVs</h2></div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">NÃºmero</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">AÃ§Ãµes</th></tr></thead><tbody id="lista-historico-davs"></tbody></table></div>
            </div>
        </div>
    </div>

    <div id="modalVenda" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeModal('modalVenda')">&times;</span><h2 class="text-2xl font-bold" id="titulo-modal-venda">ğŸ’° Nova Venda</h2></div>
            <div class="modal-body">
                <div id="form-venda-container">
                    <input type="hidden" id="venda-id-edit">
                    <label>Cliente *</label><select id="venda-cliente" required><option value="">Selecione</option></select>
                    <label>Produto *</label><select id="venda-produto" required onchange="atualizarPrecoVenda()"><option value="">Selecione</option></select>
                    <label>Representante *</label><select id="venda-representante" required><option value="">Selecione</option></select>
                    <div class="form-grid">
                        <div><label>Quantidade *</label><input type="number" id="venda-quantidade" min="1" value="1" required oninput="calcularTotalVenda()"></div>
                        <div><label>Valor UnitÃ¡rio *</label><input type="text" id="venda-valor-unitario" readonly style="background:#f9fafb"></div>
                    </div>
                    <div class="form-grid">
                        <div><label>Desconto (%)</label><input type="number" id="venda-desconto" min="0" max="100" value="0" oninput="calcularTotalVenda()"></div>
                        <div><label>Total *</label><input type="text" id="venda-total" readonly style="background:#ecfdf5;font-weight:bold;color:#059669;font-size:18px"></div>
                    </div>
                    <label>Forma de Pagamento *</label>
                    <select id="venda-pagamento" required><option value="">Selecione</option><option value="Ã€ Vista">Ã€ Vista</option><option value="CartÃ£o">CartÃ£o</option><option value="Boleto">Boleto</option><option value="30 dias">30 dias</option><option value="30/60 dias">30/60 dias</option></select>
                    <label>ObservaÃ§Ãµes</label><textarea id="venda-obs" rows="3"></textarea>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeModal('modalVenda')" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancelar</button>
                        <button onclick="salvarVenda(event)" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">ğŸ’¾ Salvar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modalCliente" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeModal('modalCliente')">&times;</span><h2 class="text-2xl font-bold" id="titulo-modal-cliente">ğŸ¥ Novo Cliente</h2></div>
            <div class="modal-body">
                <div>
                    <input type="hidden" id="cliente-id-edit">
                    <label>Nome *</label><input type="text" id="cliente-nome" required placeholder="Ex: Hospital SÃ£o Lucas">
                    <div class="form-grid">
                        <div><label>CNPJ *</label><input type="text" id="cliente-cnpj" required></div>
                        <div><label>Cidade *</label><input type="text" id="cliente-cidade" required></div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeModal('modalCliente')" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancelar</button>
                        <button onclick="salvarCliente(event)" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">ğŸ’¾ Salvar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modalProduto" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeModal('modalProduto')">&times;</span><h2 class="text-2xl font-bold" id="titulo-modal-produto">ğŸ©º Novo Produto</h2></div>
            <div class="modal-body">
                <div>
                    <input type="hidden" id="produto-codigo-edit">
                    <label>CÃ³digo *</label><input type="text" id="produto-codigo" required placeholder="Ex: MC-500">
                    <label>Nome *</label><input type="text" id="produto-nome" required placeholder="Ex: Monitor CardÃ­aco">
                    <div class="form-grid">
                        <div><label>Categoria *</label><select id="produto-categoria" required><option value="">Selecione</option><option value="Monitoramento">Monitoramento</option><option value="DiagnÃ³stico">DiagnÃ³stico</option><option value="Cardiologia">Cardiologia</option><option value="Radiologia">Radiologia</option><option value="EmergÃªncia">EmergÃªncia</option></select></div>
                        <div><label>Quantidade *</label><input type="number" id="produto-quantidade" required min="0"></div>
                    </div>
                    <div class="form-grid">
                        <div><label>Custo *</label><input type="number" id="produto-custo" required step="0.01" min="0"></div>
                        <div><label>PreÃ§o Venda *</label><input type="number" id="produto-preco" required step="0.01" min="0"></div>
                    </div>
                    <div><label>Estoque MÃ­nimo</label><input type="number" id="produto-estoque-minimo" value="5" min="0"></div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeModal('modalProduto')" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancelar</button>
                        <button onclick="salvarProduto(event)" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ğŸ’¾ Salvar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modalDAV" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeModal('modalDAV')">&times;</span><h2 class="text-2xl font-bold">ğŸ“„ Gerar DAV</h2></div>
            <div class="modal-body">
                <div>
                    <label>Cliente *</label><select id="dav-cliente" required><option value="">Selecione</option></select>
                    <label>Representante *</label><select id="dav-representante" required><option value="">Selecione</option></select>
                    <div style="border-top:2px solid #e5e7eb;margin:20px 0;padding-top:20px">
                        <label>Adicionar Produtos</label>
                        <div class="form-grid" style="margin-top:10px">
                            <div><select id="dav-produto-select"><option value="">Selecione produto</option></select></div>
                            <div style="display:flex;gap:10px"><input type="number" id="dav-quantidade-input" min="1" value="1" placeholder="Qtd" style="width:80px"><button type="button" onclick="adicionarItemDAV()" class="btn-add">â• Adicionar</button></div>
                        </div>
                    </div>
                    <div style="margin:20px 0">
                        <h4 style="font-weight:700;color:#374151;margin-bottom:10px">Itens do DAV:</h4>
                        <div style="border:1px solid #e5e7eb;border-radius:8px;overflow:hidden">
                            <table style="width:100%;font-size:14px">
                                <thead style="background:#f9fafb"><tr><th style="padding:10px;text-align:left">Produto</th><th style="padding:10px;text-align:center">Qtd</th><th style="padding:10px;text-align:right">PreÃ§o Un.</th><th style="padding:10px;text-align:right">Total</th><th style="padding:10px;text-align:center">AÃ§Ã£o</th></tr></thead>
                                <tbody id="lista-itens-dav"><tr><td colspan="5" style="padding:20px;text-align:center;color:#9ca3af">Nenhum item adicionado</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                    <div style="background:#f0fdf4;padding:15px;border-radius:8px;margin:20px 0">
                        <div style="display:flex;justify-content:space-between;align-items:center"><span style="font-size:18px;font-weight:700;color:#166534">TOTAL:</span><span id="dav-total-geral" style="font-size:24px;font-weight:700;color:#059669">R$ 0,00</span></div>
                    </div>
                    <label>CondiÃ§Ãµes de Pagamento</label><select id="dav-pagamento" required><option value="">Selecione</option><option value="Ã€ Vista">Ã€ Vista</option><option value="30 dias">30 dias</option><option value="30/60 dias">30/60 dias</option></select>
                    <label>ObservaÃ§Ãµes</label><textarea id="dav-obs" rows="3"></textarea>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeModal('modalDAV')" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancelar</button>
                        <button onclick="finalizarDAV(event)" class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">ğŸ“„ Gerar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modalDAVGerado" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeModal('modalDAVGerado')">&times;</span><h2 class="text-2xl font-bold">âœ… DAV Gerado!</h2></div>
            <div class="modal-body">
                <div id="dav-gerado-conteudo" style="background:#f9fafb;padding:20px;border-radius:10px;margin-bottom:20px;font-family:monospace;white-space:pre-wrap"></div>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="imprimirDAV()" class="btn-action btn-print flex items-center justify-center space-x-2"><span>ğŸ–¨ï¸</span><span>Imprimir</span></button>
                    <button onclick="baixarDAVPDF()" class="btn-action btn-pdf flex items-center justify-center space-x-2"><span>ğŸ“„</span><span>PDF</span></button>
                    <button onclick="enviarDAVEmail()" class="btn-action btn-email flex items-center justify-center space-x-2"><span>ğŸ“§</span><span>Email</span></button>
                    <button onclick="enviarDAVWhatsApp()" class="btn-action btn-whatsapp flex items-center justify-center space-x-2"><span>ğŸ’¬</span><span>WhatsApp</span></button>
                </div>
                <div class="flex justify-end mt-6"><button onclick="closeModal('modalDAVGerado')" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Fechar</button></div>
            </div>
        </div>
    </div>
    return;
    }
    
    const itemExistente = itensDAV.find(i => i.codigo === codigoProduto);
    
    if (itemExistente) {
        itemExistente.quantidade += quantidade;
        itemExistente.subtotal = itemExistente.quantidade * itemExistente.precoUnitario;
    } else {
        const novoItem = {
            codigo: produto.codigo,
            nome: produto.nome,
            quantidade: quantidade,
            precoUnitario: produto.precoVenda,
            subtotal: quantidade * produto.precoVenda
        };
        itensDAV.push(novoItem);
    }
    
    document.getElementById('dav-produto-select').value = '';
    document.getElementById('dav-quantidade-input').value = 1;
    renderItensDAV();
}

function removerItemDAV(codigo) {
    itensDAV = itensDAV.filter(i => i.codigo !== codigo);
    renderItensDAV();
}

function renderItensDAV() {
    const tbody = document.getElementById('lista-itens-dav');
    const totalGeral = itensDAV.reduce((sum, i) => sum + i.subtotal, 0);
    
    if (itensDAV.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-6 text-center text-gray-500">Nenhum item adicionado</td></tr>';
        document.getElementById('dav-total-geral').textContent = 'R$ 0,00';
        return;
    }
    
    tbody.innerHTML = itensDAV.map(i => `
        <tr class="border-b">
            <td class="px-4 py-3">${i.nome}</td>
            <td class="px-4 py-3 text-center">${i.quantidade}</td>
            <td class="px-4 py-3 text-right">${formatarMoeda(i.precoUnitario)}</td>
            <td class="px-4 py-3 text-right font-bold">${formatarMoeda(i.subtotal)}</td>
            <td class="px-4 py-3 text-center">
                <button onclick="removerItemDAV('${i.codigo}')" class="text-red-600 hover:text-red-800">ğŸ—‘ï¸</button>
            </td>
        </tr>
    `).join('');
    
    document.getElementById('dav-total-geral').textContent = formatarMoeda(totalGeral);
}

function finalizarDAV(event) {
    event.preventDefault();
    
    const cliente = document.getElementById('dav-cliente').value;
    const representante = document.getElementById('dav-representante').value;
    const pagamento = document.getElementById('dav-pagamento').value;
    const observacoes = document.getElementById('dav-obs').value;
    
    if (!cliente) {
        alert('âš ï¸ Selecione um cliente!');
        return;
    }
    
    if (!representante) {
        alert('âš ï¸ Selecione um representante!');
        return;
    }
    
    if (!pagamento) {
        alert('âš ï¸ Selecione a forma de pagamento!');
        return;
    }
    
    if (itensDAV.length === 0) {
        alert('âš ï¸ Adicione pelo menos um item ao DAV!');
        return;
    }
    
    const totalGeral = itensDAV.reduce((sum, i) => sum + i.subtotal, 0);
    
    const novoDAV = {
        id: historicoDAVs.length + 1,
        data: new Date().toISOString().split('T')[0],
        cliente: cliente,
        representante: representante,
        itens: [...itensDAV],
        total: totalGeral,
        pagamento: pagamento,
        observacoes: observacoes,
        status: 'Pendente'
    };
    
    historicoDAVs.push(novoDAV);
    salvarDados();
    
    alert('âœ… DAV gerado com sucesso!\n\nğŸ“‹ DAV #' + novoDAV.id + '\nğŸ’° Total: ' + formatarMoeda(totalGeral));
    
    closeModal('modalDAV');
    renderHistoricoDAVs();
}

function converterDAVEmVenda(id) {
    const dav = historicoDAVs.find(d => d.id === id);
    
    if (!dav) {
        alert('âŒ DAV nÃ£o encontrado!');
        return;
    }
    
    if (confirm('âœ… Converter DAV em venda?\n\nIsso irÃ¡:\nâ€¢ Baixar o estoque dos produtos\nâ€¢ Gerar as contas a receber\nâ€¢ Registrar as vendas')) {
        
        let vendasCriadas = 0;
        
        for (const item of dav.itens) {
            const produto = produtos.find(p => p.codigo === item.codigo);
            
            if (!produto) {
                alert(`âŒ Produto ${item.codigo} nÃ£o encontrado!`);
                continue;
            }
            
            if (item.quantidade > produto.quantidade) {
                alert(`âŒ Estoque insuficiente para ${produto.nome}!\nDisponÃ­vel: ${produto.quantidade} | NecessÃ¡rio: ${item.quantidade}`);
                continue;
            }
            
            const novaVenda = {
                id: vendas.length + 1,
                data: new Date().toISOString().split('T')[0],
                cliente: dav.cliente,
                produto: item.codigo,
                produtoNome: item.nome,
                representante: dav.representante,
                quantidade: item.quantidade,
                desconto: 0,
                valor: item.subtotal,
                pagamento: dav.pagamento,
                status: dav.pagamento === 'Ã€ Vista' ? 'Pago' : 'Pendente',
                observacoes: `Origem: DAV #${dav.id} - ${dav.observacoes || ''}`
            };
            
            vendas.push(novaVenda);
            baixarEstoque(item.codigo, item.quantidade);
            gerarContaReceber(novaVenda);
            vendasCriadas++;
        }
        
        dav.status = 'Convertido';
        
        salvarDados();
        renderVendas();
        renderHistoricoDAVs();
        atualizarContadores();
        atualizarGrafico();
        
        alert(`âœ… DAV convertido com sucesso!\n\n${vendasCriadas} venda(s) criada(s)`);
    }
}

function cancelarDAV(id) {
    if (confirm('âš ï¸ Tem certeza que deseja cancelar este DAV?')) {
        const dav = historicoDAVs.find(d => d.id === id);
        if (dav) {
            dav.status = 'Cancelado';
            salvarDados();
            renderHistoricoDAVs();
            alert('âœ… DAV cancelado!');
        }
    }
}

function renderHistoricoDAVs() {
    const tbody = document.getElementById('lista-historico-davs');
    
    if (historicoDAVs.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-500">Nenhum DAV registrado</td></tr>';
        return;
    }
    
    tbody.innerHTML = historicoDAVs.map(d => {
        const statusClass = d.status === 'Convertido' ? 'status-success' : 
                          d.status === 'Cancelado' ? 'status-danger' : 'status-warning';
        
        return `
            <tr class="border-b hover:bg-gray-50">
                <td class="px-6 py-4 font-medium">#${d.id}</td>
                <td class="px-6 py-4">${formatarData(d.data)}</td>
                <td class="px-6 py-4">${d.cliente}</td>
                <td class="px-6 py-4 font-bold text-green-600">${formatarMoeda(d.total)}</td>
                <td class="px-6 py-4"><span class="status-badge ${statusClass}">${d.status}</span></td>
                <td class="px-6 py-4">
                    ${d.status === 'Pendente' ? `
                        <button onclick="converterDAVEmVenda(${d.id})" class="btn-action btn-success text-sm mr-2">âœ… Converter</button>
                        <button onclick="cancelarDAV(${d.id})" class="btn-action btn-delete text-sm">âŒ Cancelar</button>
                    ` : `<span class="text-gray-500 text-sm">â€”</span>`}
                </td>
            </tr>
        `;
    }).join('');
}

// ========== REPRESENTANTES ==========
function abrirModalRepresentante(id = null) {
    if (id) {
        const rep = representantes.find(r => r.id === id);
        if (rep) {
            document.getElementById('titulo-modal-representante').textContent = 'âœï¸ Editar Representante';
            document.getElementById('rep-id-edit').value = id;
            document.getElementById('rep-nome').value = rep.nome;
            document.getElementById('rep-regiao').value = rep.regiao;
            document.getElementById('rep-meta').value = rep.meta;
        }
    } else {
        document.getElementById('titulo-modal-representante').textContent = 'ğŸ‘” Novo Representante';
        document.getElementById('rep-id-edit').value = '';
        document.getElementById('rep-nome').value = '';
        document.getElementById('rep-regiao').value = '';
        document.getElementById('rep-meta').value = '';
    }
    
    document.getElementById('modalRepresentante').style.display = 'block';
}

function salvarRepresentante(event) {
    event.preventDefault();
    
    const id = document.getElementById('rep-id-edit').value;
    const nome = document.getElementById('rep-nome').value;
    const regiao = document.getElementById('rep-regiao').value;
    const meta = parseFloat(document.getElementById('rep-meta').value);
    
    if (!nome || !regiao || isNaN(meta)) {
        alert('âš ï¸ Preencha todos os campos!');
        return;
    }
    
    if (id) {
        const rep = representantes.find(r => r.id === parseInt(id));
        if (rep) {
            rep.nome = nome;
            rep.regiao = regiao;
            rep.meta = meta;
        }
    } else {
        const novoRep = {
            id: representantes.length + 1,
            nome: nome,
            regiao: regiao,
            vendasMes: 0,
            meta: meta,
            performance: '0%'
        };
        representantes.push(novoRep);
    }
    
    salvarDados();
    renderRepresentantes();
    atualizarContadores();
    closeModal('modalRepresentante');
    alert('âœ… Representante salvo com sucesso!');
}

function excluirRepresentante(id) {
    if (confirm('âš ï¸ Tem certeza que deseja excluir este representante?')) {
        representantes = representantes.filter(r => r.id !== id);
        salvarDados();
        renderRepresentantes();
        atualizarContadores();
        alert('âœ… Representante excluÃ­do!');
    }
}

function renderRepresentantes() {
    const tbody = document.getElementById('lista-representantes');
    
    if (representantes.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">Nenhum representante cadastrado</td></tr>';
        return;
    }
    
    tbody.innerHTML = representantes.map(r => {
        const performance = r.meta > 0 ? ((r.vendasMes / r.meta) * 100).toFixed(1) : 0;
        const performanceClass = performance >= 100 ? 'text-green-600' : performance >= 70 ? 'text-yellow-600' : 'text-red-600';
        
        return `
            <tr class="border-b hover:bg-gray-50">
                <td class="px-6 py-4 font-medium">${r.nome}</td>
                <td class="px-6 py-4">${r.regiao}</td>
                <td class="px-6 py-4 font-bold text-green-600">${formatarMoeda(r.vendasMes || 0)}</td>
                <td class="px-6 py-4">${formatarMoeda(r.meta)}</td>
                <td class="px-6 py-4 font-bold ${performanceClass}">${performance}%</td>
                <td class="px-6 py-4">
                    <button onclick="abrirModalRepresentante(${r.id})" class="btn-action btn-edit text-sm mr-2">âœï¸</button>
                    <button onclick="excluirRepresentante(${r.id})" class="btn-action btn-delete text-sm">ğŸ—‘ï¸</button>
                </td>
            </tr>
        `;
    }).join('');
}

// ========== FORNECEDORES ==========
function abrirModalFornecedor(id = null) {
    if (id) {
        const forn = fornecedores.find(f => f.id === id);
        if (forn) {
            document.getElementById('titulo-modal-fornecedor').textContent = 'âœï¸ Editar Fornecedor';
            document.getElementById('forn-id-edit').value = id;
            document.getElementById('forn-nome').value = forn.nome;
            document.getElementById('forn-cnpj').value = forn.cnpj;
            document.getElementById('forn-especialidade').value = forn.especialidade;
        }
    } else {
        document.getElementById('titulo-modal-fornecedor').textContent = 'ğŸ­ Novo Fornecedor';
        document.getElementById('forn-id-edit').value = '';
        document.getElementById('forn-nome').value = '';
        document.getElementById('forn-cnpj').value = '';
        document.getElementById('forn-especialidade').value = '';
    }
    
    document.getElementById('modalFornecedor').style.display = 'block';
}

function salvarFornecedor(event) {
    event.preventDefault();
    
    const id = document.getElementById('forn-id-edit').value;
    const nome = document.getElementById('forn-nome').value;
    const cnpj = document.getElementById('forn-cnpj').value;
    const especialidade = document.getElementById('forn-especialidade').value;
    
    if (!nome || !cnpj || !especialidade) {
        alert('âš ï¸ Preencha todos os campos!');
        return;
    }
    
    if (id) {
        const forn = fornecedores.find(f => f.id === parseInt(id));
        if (forn) {
            forn.nome = nome;
            forn.cnpj = cnpj;
            forn.especialidade = especialidade;
        }
    } else {
        const novoForn = {
            id: fornecedores.length + 1,
            nome: nome,
            cnpj: cnpj,
            especialidade: especialidade,
            status: 'Ativo'
        };
        fornecedores.push(novoForn);
    }
    
    salvarDados();
    renderFornecedores();
    closeModal('modalFornecedor');
    alert('âœ… Fornecedor salvo com sucesso!');
}

function excluirFornecedor(id) {
    if (confirm('âš ï¸ Tem certeza que deseja excluir este fornecedor?')) {
        fornecedores = fornecedores.filter(f => f.id !== id);
        salvarDados();
        renderFornecedores();
        alert('âœ… Fornecedor excluÃ­do!');
    }
}

function renderFornecedores() {
    const tbody = document.getElementById('lista-fornecedores');
    
    if (fornecedores.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-gray-500">Nenhum fornecedor cadastrado</td></tr>';
        return;
    }
    
    tbody.innerHTML = fornecedores.map(f => `
        <tr class="border-b hover:bg-gray-50">
            <td class="px-6 py-4 font-medium">${f.nome}</td>
            <td class="px-6 py-4">${f.cnpj}</td>
            <td class="px-6 py-4">${f.especialidade}</td>
            <td class="px-6 py-4">
                <button onclick="abrirModalFornecedor(${f.id})" class="btn-action btn-edit text-sm mr-2">âœï¸</button>
                <button onclick="excluirFornecedor(${f.id})" class="btn-action btn-delete text-sm">ğŸ—‘ï¸</button>
            </td>
        </tr>
    `).join('');
}

// ========== FUNÃ‡Ã•ES AUXILIARES ==========
function preencherSelectClientes(idSelect = 'venda-cliente') {
    const select = document.getElementById(idSelect);
    select.innerHTML = '<option value="">Selecione...</option>' + 
        clientes.map(c => `<option value="${c.nome}">${c.nome}</option>`).join('');
}

function preencherSelectProdutos(idSelect = 'venda-produto') {
    const select = document.getElementById(idSelect);
    select.innerHTML = '<option value="">Selecione...</option>' + 
        produtos.map(p => `<option value="${p.codigo}">${p.nome} (${p.codigo})</option>`).join('');
}

function preencherSelectRepresentantes(idSelect = 'venda-representante') {
    const select = document.getElementById(idSelect);
    select.innerHTML = '<option value="">Selecione...</option>' + 
        representantes.map(r => `<option value="${r.nome}">${r.nome}</option>`).join('');
}

function formatarMoeda(valor) {
    return new Intl.NumberFormat('pt-BR', { 
        style: 'currency', 
        currency: 'BRL' 
    }).format(valor);
}

function formatarData(data) {
    if (!data) return '-';
    const [ano, mes, dia] = data.split('-');
    return `${dia}/${mes}/${ano}`;
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function mudarSecao(secao) {
    document.querySelectorAll('.secao').forEach(s => s.classList.add('hidden'));
    document.getElementById(secao).classList.remove('hidden');
    
    document.querySelectorAll('.menu-btn').forEach(btn => btn.classList.remove('active'));
    event.target.closest('.menu-btn').classList.add('active');
}

function atualizarContadores() {
    // Atualizar contadores do dashboard
    document.getElementById('total-vendas').textContent = vendas.length;
    document.getElementById('total-clientes').textContent = clientes.length;
    document.getElementById('total-produtos').textContent = produtos.length;
    
    const vendasMes = vendas.reduce((sum, v) => sum + v.valor, 0);
    document.getElementById('vendas-mes').textContent = formatarMoeda(vendasMes);
    
    verificarEstoqueBaixo();
}

function atualizarGrafico() {
    const ctx = document.getElementById('graficoVendas');
    if (!ctx) return;
    
    // Agrupar vendas por data
    const vendasPorData = {};
    vendas.forEach(v => {
        const data = formatarData(v.data);
        vendasPorData[data] = (vendasPorData[data] || 0) + v.valor;
    });
    
    const labels = Object.keys(vendasPorData).slice(-7);
    const dados = Object.values(vendasPorData).slice(-7);
    
    if (chartVendas) {
        chartVendas.destroy();
    }
    
    chartVendas = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Vendas (R$)',
                data: dados,
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return 'R$ ' + value.toLocaleString('pt-BR');
                        }
                    }
                }
            }
        }
    });
}

// ========== INICIALIZAÃ‡ÃƒO ==========
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸš€ Sistema Pro Hospitalar iniciando...');
    
    carregarDados();
    
    renderVendas();
    renderClientes();
    renderProdutos();
    renderRepresentantes();
    renderFornecedores();
    renderContasReceber();
    renderHistoricoDAVs();
    
    atualizarContadores();
    atualizarGrafico();
    
    // Auto-save a cada 5 minutos
    setInterval(salvarDados, 5 * 60 * 1000);
    
    console.log('âœ… Sistema carregado com sucesso!');
});

// Salvar antes de fechar
window.addEventListener('beforeunload', salvarDados);
