<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProHospitalar ERP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .active-tab { background: linear-gradient(135deg, #059669, #047857); color: white; }
        .card-hover:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(0,0,0,0.1); transition: all 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.6s ease-out; }
        .gradient-bg { background: linear-gradient(135deg, #059669 0%, #047857 100%); }
        .shadow-premium { box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
        .notification-badge { position: absolute; top: -5px; right: -5px; background: #ef4444; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center; }
        .status-online { width: 8px; height: 8px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; border-radius: 16px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .btn-primary { background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 10px 20px; border-radius: 8px; font-weight: 500; cursor: pointer; }
        .btn-primary:hover { background: linear-gradient(135deg, #059669, #047857); }
        .btn-secondary { background: #6b7280; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; }
        .btn-secondary:hover { background: #4b5563; }
        .table-row:hover { background: #f9fafb; }
        @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(400px); opacity: 0; } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-2xl">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center text-2xl">🏥</div>
                    <div>
                        <h1 class="text-2xl font-bold">ProHospitalar</h1>
                        <p class="text-green-100">Sistema ERP - Gestão Empresarial</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <button onclick="mostrarNotificacoes()" class="p-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 relative">
                        🔔
                        <div class="notification-badge">3</div>
                    </button>
                    <div class="flex items-center space-x-2">
                        <div class="status-online"></div>
                        <span class="text-sm">Online</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex">
        <!-- Sidebar -->
        <div class="w-80 bg-white shadow-2xl min-h-screen">
            <nav class="mt-6 px-4 space-y-1">
                <button onclick="showTab('dashboard')" id="tab-dashboard" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg active-tab">
                    <span class="text-xl">📊</span>
                    <span class="font-medium">Dashboard</span>
                </button>
                <button onclick="showTab('vendas')" id="tab-vendas" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100">
                    <span class="text-xl">💰</span>
                    <span class="font-medium">Vendas</span>
                </button>
                <button onclick="showTab('clientes')" id="tab-clientes" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100">
                    <span class="text-xl">🏥</span>
                    <span class="font-medium">Clientes</span>
                </button>
                <button onclick="showTab('produtos')" id="tab-produtos" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100">
                    <span class="text-xl">🩺</span>
                    <span class="font-medium">Produtos</span>
                </button>
                <button onclick="showTab('dav')" id="tab-dav" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100">
                    <span class="text-xl">📄</span>
                    <span class="font-medium">DAV</span>
                </button>
            </nav>
            
            <div class="mt-8 px-4">
                <h3 class="text-sm font-semibold text-gray-400 uppercase mb-3">Ações Rápidas</h3>
                <div class="space-y-2">
                    <button onclick="openModal('venda')" class="w-full bg-green-50 text-green-700 px-3 py-2 rounded-lg text-sm hover:bg-green-100">➕ Nova Venda</button>
                    <button onclick="openModal('cliente')" class="w-full bg-purple-50 text-purple-700 px-3 py-2 rounded-lg text-sm hover:bg-purple-100">🏥 Novo Cliente</button>
                    <button onclick="openModal('dav')" class="w-full bg-orange-50 text-orange-700 px-3 py-2 rounded-lg text-sm hover:bg-orange-100">📄 Gerar DAV</button>
                </div>
            </div>
        </div>

        <!-- Conteúdo Principal -->
        <div class="flex-1 p-8 overflow-y-auto">
            <!-- Dashboard -->
            <div id="content-dashboard" class="fade-in">
                <h2 class="text-3xl font-bold text-gray-900 mb-8">Dashboard ProHospitalar</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-green-500 to-emerald-600 p-6 rounded-2xl text-white card-hover shadow-premium">
                        <span class="text-2xl">💰</span>
                        <h3 class="text-green-100 text-sm mt-4 mb-1">Vendas do Mês</h3>
                        <p class="text-3xl font-bold">R$ 685.490</p>
                    </div>
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-2xl text-white card-hover shadow-premium">
                        <span class="text-2xl">📈</span>
                        <h3 class="text-blue-100 text-sm mt-4 mb-1">Lucro Bruto</h3>
                        <p class="text-3xl font-bold">R$ 261.857</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-6 rounded-2xl text-white card-hover shadow-premium">
                        <span class="text-2xl">🏥</span>
                        <h3 class="text-purple-100 text-sm mt-4 mb-1">Clientes Ativos</h3>
                        <p class="text-3xl font-bold">347</p>
                    </div>
                    <div class="bg-gradient-to-br from-orange-500 to-red-500 p-6 rounded-2xl text-white card-hover shadow-premium">
                        <span class="text-2xl">🩺</span>
                        <h3 class="text-orange-100 text-sm mt-4 mb-1">Produtos Ativos</h3>
                        <p class="text-3xl font-bold">2.847</p>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-2xl shadow-premium">
                    <h3 class="text-xl font-bold text-gray-900 mb-6">📊 Vendas por Mês</h3>
                    <canvas id="chartVendas" height="80"></canvas>
                </div>
            </div>

            <!-- Vendas -->
            <div id="content-vendas" class="fade-in hidden">
                <div class="flex justify-between mb-8">
                    <h2 class="text-3xl font-bold">Vendas</h2>
                    <button onclick="openModal('venda')" class="btn-primary">➕ Nova Venda</button>
                </div>
                <div class="bg-white rounded-2xl shadow-premium overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Produto</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="vendas-table" class="divide-y"></tbody>
                    </table>
                </div>
            </div>

            <!-- Clientes -->
            <div id="content-clientes" class="fade-in hidden">
                <div class="flex justify-between mb-8">
                    <h2 class="text-3xl font-bold">Clientes</h2>
                    <button onclick="openModal('cliente')" class="btn-primary">➕ Novo Cliente</button>
                </div>
                <div class="bg-white rounded-2xl shadow-premium overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">CNPJ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Telefone</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="clientes-table" class="divide-y"></tbody>
                    </table>
                </div>
            </div>

            <!-- Produtos -->
            <div id="content-produtos" class="fade-in hidden">
                <div class="flex justify-between mb-8">
                    <h2 class="text-3xl font-bold">Produtos</h2>
                    <button onclick="openModal('produto')" class="btn-primary">➕ Novo Produto</button>
                </div>
                <div class="bg-white rounded-2xl shadow-premium overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Categoria</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estoque</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Preço</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="produtos-table" class="divide-y"></tbody>
                    </table>
                </div>
            </div>

            <!-- DAV -->
            <div id="content-dav" class="fade-in hidden">
                <div class="flex justify-between mb-8">
                    <div>
                        <h2 class="text-3xl font-bold">DAV - Documentos Auxiliares de Venda</h2>
                        <p class="text-gray-600 mt-1">Geração e controle de documentos fiscais</p>
                    </div>
                    <button onclick="openModal('dav')" class="btn-primary">📄 Gerar DAV</button>
                </div>

                <div class="grid grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-xl text-white">
                        <span class="text-2xl">📄</span>
                        <h3 class="text-blue-100 text-sm mt-3 mb-1">DAVs Emitidos</h3>
                        <p class="text-3xl font-bold" id="total-davs">0</p>
                    </div>
                    <div class="bg-gradient-to-br from-green-500 to-green-600 p-6 rounded-xl text-white">
                        <span class="text-2xl">✅</span>
                        <h3 class="text-green-100 text-sm mt-3 mb-1">Aprovados</h3>
                        <p class="text-3xl font-bold" id="davs-aprovados">0</p>
                    </div>
                    <div class="bg-gradient-to-br from-yellow-500 to-orange-500 p-6 rounded-xl text-white">
                        <span class="text-2xl">⏳</span>
                        <h3 class="text-yellow-100 text-sm mt-3 mb-1">Pendentes</h3>
                        <p class="text-3xl font-bold" id="davs-pendentes">0</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-6 rounded-xl text-white">
                        <span class="text-2xl">💰</span>
                        <h3 class="text-purple-100 text-sm mt-3 mb-1">Valor Total</h3>
                        <p class="text-3xl font-bold" id="valor-total-davs">R$ 0</p>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-premium overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nº DAV</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="dav-table" class="divide-y"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="p-6 border-b flex justify-between items-center">
                <h3 id="modal-title" class="text-2xl font-bold"></h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="modal-body" class="p-6"></div>
        </div>
    </div>

    <!-- Modal Notificações -->
    <div id="modal-notificacoes" class="modal">
        <div class="modal-content max-w-md">
            <div class="p-6 border-b flex justify-between">
                <h3 class="text-xl font-bold">🔔 Notificações</h3>
                <button onclick="document.getElementById('modal-notificacoes').classList.remove('active')" class="text-2xl">&times;</button>
            </div>
            <div class="p-6 space-y-4">
                <div class="p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                    <p class="font-medium text-red-800">Estoque Baixo</p>
                    <p class="text-sm text-red-600">12 produtos precisam reposição</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DADOS DO SISTEMA
        let dados = {
            vendas: [
                { id: 1, cliente: 'Hospital São Lucas', produto: 'Monitor Cardíaco', valor: 45890, status: 'Concluída' },
                { id: 2, cliente: 'Clínica Santa Maria', produto: 'Raio-X Digital', valor: 125000, status: 'Pendente' }
            ],
            clientes: [
                { id: 1, nome: 'Hospital São Lucas', cnpj: '12.345.678/0001-90', telefone: '(71) 3333-4444' },
                { id: 2, nome: 'Clínica Santa Maria', cnpj: '23.456.789/0001-80', telefone: '(71) 3222-5555' }
            ],
            produtos: [
                { id: 1, nome: 'Monitor Cardíaco', categoria: 'Cardiologia', estoque: 45, preco: 45890 },
                { id: 2, nome: 'Raio-X Digital', categoria: 'Radiologia', estoque: 8, preco: 125000 }
            ],
            davs: [
                { 
                    id: 1, 
                    numero: 'DAV-2024-001', 
                    data: '2024-01-19', 
                    cliente: 'Hospital São Lucas',
                    produtos: [{ nome: 'Monitor Cardíaco', quantidade: 2, valorUnitario: 45890, valorTotal: 91780 }],
                    valorTotal: 91780, 
                    status: 'Aprovado'
                }
            ]
        };

        // FUNÇÕES DE NAVEGAÇÃO
        function showTab(tabName) {
            document.querySelectorAll('[id^="content-"]').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('active-tab');
                btn.classList.add('text-gray-700', 'hover:bg-gray-100');
            });
            
            document.getElementById('content-' + tabName).classList.remove('hidden');
            const btn = document.getElementById('tab-' + tabName);
            btn.classList.add('active-tab');
            btn.classList.remove('text-gray-700', 'hover:bg-gray-100');
            
            carregarDados(tabName);
        }

        function carregarDados(tipo) {
            if (tipo === 'vendas') renderVendas();
            if (tipo === 'clientes') renderClientes();
            if (tipo === 'produtos') renderProdutos();
            if (tipo === 'dav') { renderDAVs(); atualizarEstatisticasDAV(); }
        }

        // RENDER VENDAS
        function renderVendas() {
            const tbody = document.getElementById('vendas-table');
            tbody.innerHTML = dados.vendas.map(v => `
                <tr class="table-row">
                    <td class="px-6 py-4">${v.cliente}</td>
                    <td class="px-6 py-4">${v.produto}</td>
                    <td class="px-6 py-4 font-bold text-green-600">R$ ${v.valor.toLocaleString('pt-BR')}</td>
                    <td class="px-6 py-4">
                        <button onclick="excluirItem('vendas', ${v.id})" class="text-red-600">🗑️</button>
                    </td>
                </tr>
            `).join('');
        }

        // RENDER CLIENTES
        function renderClientes() {
            const tbody = document.getElementById('clientes-table');
            tbody.innerHTML = dados.clientes.map(c => `
                <tr class="table-row">
                    <td class="px-6 py-4">${c.nome}</td>
                    <td class="px-6 py-4">${c.cnpj}</td>
                    <td class="px-6 py-4">${c.telefone}</td>
                    <td class="px-6 py-4">
                        <button onclick="excluirItem('clientes', ${c.id})" class="text-red-600">🗑️</button>
                    </td>
                </tr>
            `).join('');
        }

        // RENDER PRODUTOS
        function renderProdutos() {
            const tbody = document.getElementById('produtos-table');
            tbody.innerHTML = dados.produtos.map(p => `
                <tr class="table-row">
                    <td class="px-6 py-4">${p.nome}</td>
                    <td class="px-6 py-4">${p.categoria}</td>
                    <td class="px-6 py-4">${p.estoque} un.</td>
                    <td class="px-6 py-4 font-bold text-green-600">R$ ${p.preco.toLocaleString('pt-BR')}</td>
                    <td class="px-6 py-4">
                        <button onclick="excluirItem('produtos', ${p.id})" class="text-red-600">🗑️</button>
                    </td>
                </tr>
            `).join('');
        }

        // RENDER DAVs
        function renderDAVs() {
            const tbody = document.getElementById('dav-table');
            tbody.innerHTML = dados.davs.map(d => `
                <tr class="table-row">
                    <td class="px-6 py-4 font-bold">${d.numero}</td>
                    <td class="px-6 py-4">${new Date(d.data).toLocaleDateString('pt-BR')}</td>
                    <td class="px-6 py-4">${d.cliente}</td>
                    <td class="px-6 py-4 font-bold text-green-600">R$ ${d.valorTotal.toLocaleString('pt-BR')}</td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 text-xs rounded-full ${d.status === 'Aprovado' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                            ${d.status}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <button onclick="visualizarDAV(${d.id})" class="text-blue-600 mr-2">👁️</button>
                        <button onclick="exportarDAV(${d.id})" class="text-green-600 mr-2">📄</button>
                        <button onclick="excluirItem('davs', ${d.id})" class="text-red-600">🗑️</button>
                    </td>
                </tr>
            `).join('');
        }

        function atualizarEstatisticasDAV() {
            document.getElementById('total-davs').textContent = dados.davs.length;
            document.getElementById('davs-aprovados').textContent = dados.davs.filter(d => d.status === 'Aprovado').length;
            document.getElementById('davs-pendentes').textContent = dados.davs.filter(d => d.status === 'Pendente').length;
            const total = dados.davs.reduce((acc, d) => acc + d.valorTotal, 0);
            document.getElementById('valor-total-davs').textContent = 'R$ ' + total.toLocaleString('pt-BR');
        }

        // MODAL
        function openModal(tipo) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');
            
            let html = '';
            
            if (tipo === 'venda') {
                title.textContent = '➕ Nova Venda';
                html = `
                    <form onsubmit="salvarVenda(event)" class="space-y-4">
                        <select name="cliente" required class="w-full px-4 py-2 border rounded-lg">
                            <option value="">Selecione o cliente</option>
                            ${dados.clientes.map(c => `<option>${c.nome}</option>`).join('')}
                        </select>
                        <select name="produto" required class="w-full px-4 py-2 border rounded-lg">
                            <option value="">Selecione o produto</option>
                            ${dados.produtos.map(p => `<option data-preco="${p.preco}">${p.nome}</option>`).join('')}
                        </select>
                        <input type="number" name="valor" required class="w-full px-4 py-2 border rounded-lg" placeholder="Valor">
                        <div class="flex space-x-3">
                            <button type="submit" class="btn-primary flex-1">Salvar</button>
                            <button type="button" onclick="closeModal()" class="btn-secondary">Cancelar</button>
                        </div>
                    </form>
                `;
            } else if (tipo === 'dav') {
                title.textContent = '📄 Gerar DAV';
                html = `
                    <form onsubmit="salvarDAV(event)" class="space-y-4">
                        <select name="cliente" required class="w-full px-4 py-2 border rounded-lg">
                            <option value="">Selecione o cliente</option>
                            ${dados.clientes.map(c => `<option>${c.nome}</option>`).join('')}
                        </select>
                        <div id="produtos-dav">
                            <div class="produto-item space-y-2 p-4 bg-gray-50 rounded-lg mb-3">
                                <select name="produto[]" required class="w-full px-4 py-2 border rounded-lg produto-select">
                                    <option value="">Selecione o produto</option>
                                    ${dados.produtos.map(p => `<option value="${p.nome}" data-preco="${p.preco}">${p.nome} - R$ ${p.preco.toLocaleString('pt-BR')}</option>`).join('')}
                                </select>
                                <div class="flex space-x-2">
                                    <input type="number" name="quantidade[]" placeholder="Qtd" required min="1" class="w-1/3 px-4 py-2 border rounded-lg quantidade-input">
                                    <input type="number" name="valorUnitario[]" placeholder="Valor Unit." required class="w-2/3 px-4 py-2 border rounded-lg valor-input">
                                </div>
                            </div>
                        </div>
                        <button type="button" onclick="adicionarProdutoDAV()" class="w-full px-4 py-2 border-2 border-dashed border-green-300 text-green-600 rounded-lg hover:bg-green-50">
                            ➕ Adicionar Produto
                        </button>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="font-medium">Valor Total:</span>
                                <span id="valor-total-preview" class="text-2xl font-bold text-green-600">R$ 0,00</span>
                            </div>
                        </div>
                        <div class="flex space-x-3">
                            <button type="submit" class="btn-primary flex-1">Gerar DAV</button>
                            <button type="button" onclick="closeModal()" class="btn-secondary">Cancelar</button>
                        </div>
                    </form>
                `;
            }
            
            body.innerHTML = html;
            modal.classList.add('active');
            
            if (tipo === 'dav') {
                setTimeout(configurarCalculoDAV, 100);
            }
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // SALVAR FUNÇÕES
        function salvarVenda(event) {
            event.preventDefault();
            const form = event.target;
            const novaVenda = {
                id: dados.vendas.length + 1,
                cliente: form.cliente.value,
                produto: form.produto.value,
                valor: parseFloat(form.valor.value),
                status: 'Concluída'
            };
            dados.vendas.unshift(novaVenda);
            closeModal();
            renderVendas();
            mostrarAlerta('Venda adicionada com sucesso!', 'success');
        }

        function salvarCliente(event) {
            event.preventDefault();
            const form = event.target;
            const novoCliente = {
                id: dados.clientes.length + 1,
                nome: form.nome.value,
                cnpj: form.cnpj.value,
                telefone: form.telefone.value
            };
            dados.clientes.push(novoCliente);
            closeModal();
            renderClientes();
            mostrarAlerta('Cliente adicionado com sucesso!', 'success');
        }

        function salvarProduto(event) {
            event.preventDefault();
            const form = event.target;
            const novoProduto = {
                id: dados.produtos.length + 1,
                nome: form.nome.value,
                categoria: form.categoria.value,
                estoque: parseInt(form.estoque.value),
                preco: parseFloat(form.preco.value)
            };
            dados.produtos.push(novoProduto);
            closeModal();
            renderProdutos();
            mostrarAlerta('Produto adicionado com sucesso!', 'success');
        }

        function salvarDAV(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            
            const produtosNomes = formData.getAll('produto[]');
            const quantidades = formData.getAll('quantidade[]');
            const valoresUnitarios = formData.getAll('valorUnitario[]');
            
            const produtos = produtosNomes.map((nome, index) => {
                const quantidade = parseInt(quantidades[index]);
                const valorUnitario = parseFloat(valoresUnitarios[index]);
                return {
                    nome: nome,
                    quantidade: quantidade,
                    valorUnitario: valorUnitario,
                    valorTotal: quantidade * valorUnitario
                };
            });
            
            const valorTotal = produtos.reduce((acc, p) => acc + p.valorTotal, 0);
            const novoId = dados.davs.length + 1;
            const numeroDAV = `DAV-2024-${String(novoId).padStart(3, '0')}`;
            
            const novoDAV = {
                id: novoId,
                numero: numeroDAV,
                data: new Date().toISOString().split('T')[0],
                cliente: formData.get('cliente'),
                produtos: produtos,
                valorTotal: valorTotal,
                status: 'Pendente'
            };
            
            dados.davs.unshift(novoDAV);
            closeModal();
            showTab('dav');
            renderDAVs();
            atualizarEstatisticasDAV();
            mostrarAlerta('DAV gerado com sucesso! 📄', 'success');
        }

        // FUNÇÕES DAV
        function adicionarProdutoDAV() {
            const container = document.getElementById('produtos-dav');
            const html = `
                <div class="produto-item space-y-2 p-4 bg-gray-50 rounded-lg mb-3">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-medium">Produto</label>
                        <button type="button" onclick="this.closest('.produto-item').remove(); calcularTotalDAV()" class="text-red-600">❌</button>
                    </div>
                    <select name="produto[]" required class="w-full px-4 py-2 border rounded-lg produto-select">
                        <option value="">Selecione o produto</option>
                        ${dados.produtos.map(p => `<option value="${p.nome}" data-preco="${p.preco}">${p.nome} - R$ ${p.preco.toLocaleString('pt-BR')}</option>`).join('')}
                    </select>
                    <div class="flex space-x-2">
                        <input type="number" name="quantidade[]" placeholder="Qtd" required min="1" class="w-1/3 px-4 py-2 border rounded-lg quantidade-input">
                        <input type="number" name="valorUnitario[]" placeholder="Valor Unit." required class="w-2/3 px-4 py-2 border rounded-lg valor-input">
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
            configurarCalculoDAV();
        }

        function configurarCalculoDAV() {
            const form = document.querySelector('form');
            if (!form) return;
            
            form.addEventListener('change', calcularTotalDAV);
            form.addEventListener('input', calcularTotalDAV);
            
            const selects = form.querySelectorAll('.produto-select');
            selects.forEach(select => {
                select.addEventListener('change', function() {
                    const option = this.options[this.selectedIndex];
                    const preco = option.getAttribute('data-preco');
                    const container = this.closest('.produto-item');
                    const valorInput = container.querySelector('.valor-input');
                    if (preco && valorInput) {
                        valorInput.value = preco;
                        calcularTotalDAV();
                    }
                });
            });
        }

        function calcularTotalDAV() {
            const quantidades = document.querySelectorAll('input[name="quantidade[]"]');
            const valores = document.querySelectorAll('input[name="valorUnitario[]"]');
            let total = 0;
            
            quantidades.forEach((qtdInput, index) => {
                const qtd = parseFloat(qtdInput.value) || 0;
                const valor = parseFloat(valores[index].value) || 0;
                total += qtd * valor;
            });
            
            const preview = document.getElementById('valor-total-preview');
            if (preview) {
                preview.textContent = 'R$ ' + total.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            }
        }

        function visualizarDAV(id) {
            const dav = dados.davs.find(d => d.id === id);
            if (!dav) return;
            
            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');
            
            title.textContent = `📄 DAV ${dav.numero}`;
            
            body.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-xl">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-2xl font-bold text-gray-900">${dav.numero}</h3>
                                <p class="text-gray-600">Emitido em ${new Date(dav.data).toLocaleDateString('pt-BR')}</p>
                            </div>
                            <span class="px-4 py-2 rounded-full text-sm font-medium ${dav.status === 'Aprovado' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                ${dav.status}
                            </span>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-600">Cliente</p>
                                <p class="font-bold text-gray-900">${dav.cliente}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Valor Total</p>
                                <p class="font-bold text-green-600 text-xl">R$ ${dav.valorTotal.toLocaleString('pt-BR')}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-bold text-gray-900 mb-3">📦 Produtos</h4>
                        <div class="space-y-2">
                            ${dav.produtos.map(p => `
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <div class="flex-1">
                                        <p class="font-medium text-gray-900">${p.nome}</p>
                                        <p class="text-sm text-gray-600">Qtd: ${p.quantidade} x R$ ${p.valorUnitario.toLocaleString('pt-BR')}</p>
                                    </div>
                                    <p class="font-bold text-green-600">R$ ${p.valorTotal.toLocaleString('pt-BR')}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="exportarDAV(${id})" class="btn-primary flex-1">📄 Exportar</button>
                        <button onclick="closeModal()" class="btn-secondary">Fechar</button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        }

        function exportarDAV(id) {
            const dav = dados.davs.find(d => d.id === id);
            if (!dav) return;
            
            let conteudo = `DOCUMENTO AUXILIAR DE VENDA\n\n`;
            conteudo += `Número: ${dav.numero}\n`;
            conteudo += `Data: ${new Date(dav.data).toLocaleDateString('pt-BR')}\n`;
            conteudo += `Cliente: ${dav.cliente}\n`;
            conteudo += `Status: ${dav.status}\n\n`;
            conteudo += `PRODUTOS:\n`;
            conteudo += `Produto,Quantidade,Valor Unit.,Valor Total\n`;
            
            dav.produtos.forEach(p => {
                conteudo += `${p.nome},${p.quantidade},${p.valorUnitario},${p.valorTotal}\n`;
            });
            
            conteudo += `\nVALOR TOTAL: R$ ${dav.valorTotal.toFixed(2)}\n`;
            
            const blob = new Blob([conteudo], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${dav.numero}.txt`;
            a.click();
            
            mostrarAlerta('DAV exportado com sucesso! 📄', 'success');
        }

        // EXCLUIR ITEM
        function excluirItem(tipo, id) {
            if (confirm('Tem certeza que deseja excluir este item?')) {
                dados[tipo] = dados[tipo].filter(item => item.id !== id);
                carregarDados(tipo === 'vendas' ? 'vendas' : tipo === 'clientes' ? 'clientes' : tipo === 'produtos' ? 'produtos' : 'dav');
                mostrarAlerta('Item excluído com sucesso!', 'success');
            }
        }

        // NOTIFICAÇÕES
        function mostrarNotificacoes() {
            document.getElementById('modal-notificacoes').classList.add('active');
        }

        // ALERTAS
        function mostrarAlerta(mensagem, tipo) {
            const cores = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };
            
            const alerta = document.createElement('div');
            alerta.className = `fixed top-20 right-6 ${cores[tipo]} text-white px-6 py-4 rounded-lg shadow-2xl z-50`;
            alerta.style.animation = 'slideIn 0.3s ease-out';
            alerta.innerHTML = `
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">${tipo === 'success' ? '✅' : tipo === 'error' ? '❌' : 'ℹ️'}</span>
                    <span class="font-medium">${mensagem}</span>
                </div>
            `;
            
            document.body.appendChild(alerta);
            
            setTimeout(() => {
                alerta.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => alerta.remove(), 300);
            }, 3000);
        }

        // GRÁFICO
        function initCharts() {
            const ctx = document.getElementById('chartVendas');
            if (!ctx) return;
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    datasets: [{
                        label: 'Vendas 2024',
                        data: [450000, 520000, 480000, 590000, 630000, 685490],
                        borderColor: '#059669',
                        backgroundColor: 'rgba(5, 150, 105, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: true }
                    }
                }
            });
        }

        // INICIALIZAÇÃO
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🏥 ProHospitalar ERP Iniciado');
            showTab('dashboard');
            setTimeout(initCharts, 100);
            setTimeout(() => mostrarAlerta('Sistema carregado com sucesso! 🏥', 'success'), 500);
            
            // Fechar modal ao clicar fora
            document.getElementById('modal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
            
            document.getElementById('modal-notificacoes').addEventListener('click', function(e) {
                if (e.target === this) this.classList.remove('active');
            });
        });
    </script>
</body>
</html>()" class="btn-secondary">Cancelar</button>
                        </div>
                    </form>
                `;
            } else if (tipo === 'cliente') {
                title.textContent = '➕ Novo Cliente';
                html = `
                    <form onsubmit="salvarCliente(event)" class="space-y-4">
                        <input type="text" name="nome" required class="w-full px-4 py-2 border rounded-lg" placeholder="Nome">
                        <input type="text" name="cnpj" required class="w-full px-4 py-2 border rounded-lg" placeholder="CNPJ">
                        <input type="text" name="telefone" required class="w-full px-4 py-2 border rounded-lg" placeholder="Telefone">
                        <div class="flex space-x-3">
                            <button type="submit" class="btn-primary flex-1">Salvar</button>
                            <button type="button" onclick="closeModal()" class="btn-secondary">Cancelar</button>
                        </div>
                    </form>
                `;
            } else if (tipo === 'produto') {
                title.textContent = '➕ Novo Produto';
                html = `
                    <form onsubmit="salvarProduto(event)" class="space-y-4">
                        <input type="text" name="nome" required class="w-full px-4 py-2 border rounded-lg" placeholder="Nome">
                        <input type="text" name="categoria" required class="w-full px-4 py-2 border rounded-lg" placeholder="Categoria">
                        <input type="number" name="estoque" required class="w-full px-4 py-2 border rounded-lg" placeholder="Estoque">
                        <input type="number" name="preco" required class="w-full px-4 py-2 border rounded-lg" placeholder="Preço">
                        <div class="flex space-x-3">
                            <button type="submit" class="btn-primary flex-1">Salvar</button>
                            <button type="button" onclick="closeModal
