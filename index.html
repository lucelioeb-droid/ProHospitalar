<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProHospitalar - Sistema ERP Completo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .active-tab { background: linear-gradient(135deg, #059669, #047857); color: white; }
        .card-hover:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.6s ease-out; }
        .gradient-bg { background: linear-gradient(135deg, #059669 0%, #047857 100%); }
        .shadow-premium { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        .btn-export { background: linear-gradient(135deg, #10b981, #059669); transition: all 0.3s ease; }
        .btn-export:hover { background: linear-gradient(135deg, #059669, #047857); transform: translateY(-2px); }
        .notification-badge { position: absolute; top: -5px; right: -5px; background: #ef4444; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .status-online { width: 8px; height: 8px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: white; margin: 2% auto; padding: 0; border-radius: 15px; width: 90%; max-width: 900px; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px rgba(0,0,0,0.3); }
        .modal-header { background: linear-gradient(135deg, #059669, #047857); color: white; padding: 20px; border-radius: 15px 15px 0 0; }
        .modal-body { padding: 25px; }
        .close { color: white; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { opacity: 0.8; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; margin-top: 5px; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #059669; }
        label { font-weight: 600; color: #374151; margin-top: 12px; display: block; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn-add { background: #10b981; color: white; padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; }
        .btn-add:hover { background: #059669; }
        .btn-remove { background: #ef4444; color: white; padding: 4px 12px; border-radius: 4px; border: none; cursor: pointer; font-size: 12px; }
        .btn-remove:hover { background: #dc2626; }
        .btn-edit { background: #3b82f6; color: white; padding: 6px 12px; border-radius: 6px; border: none; cursor: pointer; font-size: 12px; font-weight: 600; margin-right: 5px; }
        .btn-edit:hover { background: #2563eb; }
        .btn-delete { background: #ef4444; color: white; padding: 6px 12px; border-radius: 6px; border: none; cursor: pointer; font-size: 12px; font-weight: 600; }
        .btn-delete:hover { background: #dc2626; }
        .btn-action { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s; }
        .btn-print { background: #3b82f6; color: white; }
        .btn-print:hover { background: #2563eb; transform: translateY(-2px); }
        .btn-pdf { background: #ef4444; color: white; }
        .btn-pdf:hover { background: #dc2626; transform: translateY(-2px); }
        .btn-email { background: #8b5cf6; color: white; }
        .btn-email:hover { background: #7c3aed; transform: translateY(-2px); }
        .btn-whatsapp { background: #25d366; color: white; }
        .btn-whatsapp:hover { background: #20ba5a; transform: translateY(-2px); }
        .btn-pagar { background: #10b981; color: white; padding: 6px 12px; border-radius: 6px; border: none; cursor: pointer; font-size: 12px; font-weight: 600; margin-right: 5px; }
        .btn-pagar:hover { background: #059669; }
        .alerta-estoque { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 10px; border-radius: 6px; margin: 10px 0; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <header class="gradient-bg text-white shadow-2xl">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center text-2xl">üè•</div>
                    <div>
                        <h1 class="text-2xl font-bold">ProHospitalar</h1>
                        <p class="text-green-100 text-sm">Sistema ERP - Gest√£o Empresarial</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <button onclick="mostrarNotificacoes()" class="p-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all relative">
                        üîî<div class="notification-badge" id="alert-count">3</div>
                    </button>
                    <button onclick="fazerBackupManual()" class="p-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all" title="Backup Manual">
                        üíæ
                    </button>
                    <div class="flex items-center space-x-2">
                        <div class="status-online"></div>
                        <span class="text-sm text-green-100">Online</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="text-right">
                            <p class="text-sm font-medium">Admin ProHospitalar</p>
                            <p class="text-xs text-green-100">Conectado agora</p>
                        </div>
                        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">üë®‚Äçüíº</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex">
        <div class="w-80 bg-white shadow-2xl min-h-screen">
            <nav class="mt-6">
                <div class="px-4 space-y-1">
                    <button onclick="showTab('dashboard')" id="tab-dashboard" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all active-tab">
                        <span class="text-xl">üìä</span>
                        <div class="flex-1 text-left"><span class="font-medium">Dashboard</span><p class="text-xs opacity-80">Painel Executivo</p></div>
                    </button>
                    <button onclick="showTab('vendas')" id="tab-vendas" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">üí∞</span>
                        <div class="flex-1 text-left"><span class="font-medium">Vendas</span><p class="text-xs text-gray-500">Pedidos e faturamento</p></div>
                    </button>
                    <button onclick="showTab('contas-receber')" id="tab-contas-receber" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">üíµ</span>
                        <div class="flex-1 text-left"><span class="font-medium">Contas a Receber</span><p class="text-xs text-gray-500">Recebimentos</p></div>
                        <div class="notification-badge" id="receber-count">0</div>
                    </button>
                    <button onclick="showTab('clientes')" id="tab-clientes" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">üè•</span>
                        <div class="flex-1 text-left"><span class="font-medium">Clientes</span><p class="text-xs text-gray-500">Hospitais e Cl√≠nicas</p></div>
                    </button>
                    <button onclick="showTab('estoque')" id="tab-estoque" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">ü©∫</span>
                        <div class="flex-1 text-left"><span class="font-medium">Produtos</span><p class="text-xs text-gray-500">Equipamentos m√©dicos</p></div>
                        <div class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded font-medium" id="estoque-baixo">0</div>
                    </button>
                    <button onclick="showTab('vendedores')" id="tab-vendedores" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">üë®‚Äçüíº</span>
                        <div class="flex-1 text-left"><span class="font-medium">Representantes</span><p class="text-xs text-gray-500">Equipe comercial</p></div>
                    </button>
                    <button onclick="showTab('fornecedores')" id="tab-fornecedores" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">üè≠</span>
                        <div class="flex-1 text-left"><span class="font-medium">Fornecedores</span><p class="text-xs text-gray-500">Ind√∫stria m√©dica</p></div>
                    </button>
                    <button onclick="showTab('financeiro')" id="tab-financeiro" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">üí≥</span>
                        <div class="flex-1 text-left"><span class="font-medium">Financeiro</span><p class="text-xs text-gray-500">Fluxo de caixa</p></div>
                    </button>
                    <button onclick="showTab('historico-davs')" id="tab-historico-davs" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
                        <span class="text-xl">üìÑ</span>
                        <div class="flex-1 text-left"><span class="font-medium">Hist√≥rico DAVs</span><p class="text-xs text-gray-500">Documentos gerados</p></div>
                    </button>
                </div>
                <div class="mt-8 px-4">
                    <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wide mb-3">A√ß√µes R√°pidas</h3>
                    <div class="space-y-2">
                        <button onclick="openModal('venda')" class="w-full bg-green-50 text-green-700 px-3 py-2 rounded-lg text-sm hover:bg-green-100 transition-colors font-medium">‚ûï Nova Venda</button>
                        <button onclick="openModal('produto')" class="w-full bg-blue-50 text-blue-700 px-3 py-2 rounded-lg text-sm hover:bg-blue-100 transition-colors font-medium">ü©∫ Novo Produto</button>
                        <button onclick="openModal('cliente')" class="w-full bg-purple-50 text-purple-700 px-3 py-2 rounded-lg text-sm hover:bg-purple-100 transition-colors font-medium">üè• Novo Cliente</button>
                        <button onclick="openModal('dav')" class="w-full bg-orange-50 text-orange-700 px-3 py-2 rounded-lg text-sm hover:bg-orange-100 transition-colors font-medium">üìÑ Gerar DAV</button>
                    </div>
                </div>
                <div class="mt-8 mx-4 p-4 bg-green-50 rounded-xl border border-green-200">
                    <div class="text-center">
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2">
                            <span class="text-2xl">üíæ</span>
                        </div>
                        <h4 class="font-bold text-green-800">Backup Autom√°tico</h4>
                        <p class="text-xs text-green-600 mt-1">Dados salvos automaticamente</p>
                        <p class="text-xs text-green-500 mt-2 font-medium" id="ultimo-backup">Nunca</p>
                    </div>
                </div>
            </nav>
        </div>

        <div class="flex-1 p-8 overflow-y-auto" style="max-height: calc(100vh - 80px);">
            <div id="dashboard" class="fade-in">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">Dashboard ProHospitalar</h2>
                        <p class="text-gray-600 mt-1">Gest√£o completa de equipamentos m√©dico-hospitalares</p>
                    </div>
                    <button onclick="exportarDashboard()" class="btn-export text-white px-6 py-3 rounded-lg flex items-center space-x-2 shadow-lg">
                        <span>üìä</span><span>Exportar Dashboard</span>
                    </button>
                </div>
                
                <div id="alertas-dashboard"></div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-green-500 to-emerald-600 p-6 rounded-2xl text-white card-hover shadow-premium">
                        <h3 class="text-green-100 text-sm mb-1">Vendas do M√™s</h3>
                        <p class="text-3xl font-bold" id="dash-vendas">R$ 0</p>
                    </div>
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-2xl text-white card-hover shadow-premium">
                        <h3 class="text-blue-100 text-sm mb-1">A Receber</h3>
                        <p class="text-3xl font-bold" id="dash-receber">R$ 0</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-6 rounded-2xl text-white card-hover shadow-premium">
                        <h3 class="text-purple-100 text-sm mb-1">Clientes Ativos</h3>
                        <p class="text-3xl font-bold" id="dash-clientes">0</p>
                    </div>
                    <div class="bg-gradient-to-br from-orange-500 to-red-500 p-6 rounded-2xl text-white card-hover shadow-premium">
                        <h3 class="text-orange-100 text-sm mb-1">Produtos Ativos</h3>
                        <p class="text-3xl font-bold" id="dash-produtos">0</p>
                    </div>
                    <div class="bg-gradient-to-br from-indigo-500 to-purple-600 p-6 rounded-2xl text-white card-hover shadow-premium">
                        <h3 class="text-indigo-100 text-sm mb-1">Estoque Baixo</h3>
                        <p class="text-3xl font-bold" id="dash-estoque-baixo">0</p>
                    </div>
                </div>
                <div class="bg-white p-8 rounded-2xl shadow-premium mb-8">
                    <h3 class="text-xl font-bold text-gray-900 mb-6">üìä Vendas por Categoria</h3>
                    <canvas id="chartVendasCategorias"></canvas>
                </div>
            </div>

            <div id="vendas" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">üí∞ Gest√£o de Vendas</h2>
                    <button onclick="exportarVendas()" class="btn-export text-white px-6 py-3 rounded-lg flex items-center space-x-2 shadow-lg">
                        <span>üìÑ</span><span>Exportar Vendas</span>
                    </button>
                </div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Produto</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="lista-vendas"></tbody>
                    </table>
                </div>
            </div>

            <div id="contas-receber" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">üíµ Contas a Receber</h2>
                    <button onclick="exportarContasReceber()" class="btn-export text-white px-6 py-3 rounded-lg flex items-center space-x-2 shadow-lg">
                        <span>üìÑ</span><span>Exportar</span>
                    </button>
                </div>
                <div class="grid grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-premium">
                        <h3 class="text-gray-600 text-sm mb-2">Total a Receber</h3>
                        <p class="text-3xl font-bold text-orange-600" id="total-receber">R$ 0,00</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-premium">
                        <h3 class="text-gray-600 text-sm mb-2">Vencidas</h3>
                        <p class="text-3xl font-bold text-red-600" id="total-vencidas">R$ 0,00</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-premium">
                        <h3 class="text-gray-600 text-sm mb-2">Recebido</h3>
                        <p class="text-3xl font-bold text-green-600" id="total-recebido">R$ 0,00</p>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Venda</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Vencimento</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="lista-contas-receber"></tbody>
                    </table>
                </div>
            </div>

            <div id="clientes" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">üè• Gest√£o de Clientes</h2>
                    <button onclick="exportarClientes()" class="btn-export text-white px-6 py-3 rounded-lg flex items-center space-x-2 shadow-lg">
                        <span>üìÑ</span><span>Exportar Clientes</span>
                    </button>
                </div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">CNPJ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cidade</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="lista-clientes"></tbody>
                    </table>
                </div>
            </div>

            <div id="estoque" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">ü©∫ Gest√£o de Produtos</h2>
                    <button onclick="exportarProdutos()" class="btn-export text-white px-6 py-3 rounded-lg flex items-center space-x-2 shadow-lg">
                        <span>üìÑ</span><span>Exportar Produtos</span>
                    </button>
                </div>
                <div id="alerta-estoque-baixo"></div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">C√≥digo</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Produto</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Quantidade</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Pre√ßo</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="lista-produtos"></tbody>
                    </table>
                </div>
            </div>
            <div id="vendedores" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">üë®‚Äçüíº Representantes</h2>
                    <button onclick="exportarRepresentantes()" class="btn-export text-white px-6 py-3 rounded-lg flex items-center space-x-2 shadow-lg">
                        <span>üìÑ</span><span>Exportar Representantes</span>
                    </button>
                </div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Regi√£o</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Vendas</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="lista-representantes"></tbody>
                    </table>
                </div>
            </div>

            <div id="fornecedores" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">üè≠ Fornecedores</h2>
                    <button onclick="exportarFornecedores()" class="btn-export text-white px-6 py-3 rounded-lg flex items-center space-x-2 shadow-lg">
                        <span>üìÑ</span><span>Exportar Fornecedores</span>
                    </button>
                </div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">CNPJ</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Especialidade</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="lista-fornecedores"></tbody>
                    </table>
                </div>
            </div>

            <div id="financeiro" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">üí≥ Financeiro</h2>
                    <button onclick="exportarFinanceiro()" class="btn-export text-white px-6 py-3 rounded-lg flex items-center space-x-2 shadow-lg">
                        <span>üìÑ</span><span>Exportar Financeiro</span>
                    </button>
                </div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Descri√ß√£o</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th>
                            </tr>
                        </thead>
                        <tbody id="lista-transacoes"></tbody>
                    </table>
                </div>
            </div>

            <div id="historico-davs" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">üìÑ Hist√≥rico de DAVs</h2>
                    <button onclick="exportarHistoricoDAVs()" class="btn-export text-white px-6 py-3 rounded-lg flex items-center space-x-2 shadow-lg">
                        <span>üìÑ</span><span>Exportar Hist√≥rico</span>
                    </button>
                </div>
                <div class="bg-white rounded-xl shadow-premium overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">N√∫mero DAV</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="lista-historico-davs"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL NOVA VENDA -->
    <div id="modalVenda" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal('modalVenda')">&times;</span>
                <h2 class="text-2xl font-bold" id="titulo-modal-venda">üí∞ Nova Venda</h2>
            </div>
            <div class="modal-body">
                <form id="formVenda" onsubmit="salvarVenda(event)">
                    <input type="hidden" id="venda-id-edit">
                    <label>Cliente *</label>
                    <select id="venda-cliente" required><option value="">Selecione</option></select>
                    <label>Produto *</label>
                    <select id="venda-produto" required onchange="atualizarPrecoVenda()"><option value="">Selecione</option></select>
                    <label>Representante *</label>
                    <select id="venda-representante" required><option value="">Selecione</option></select>
                    <div class="form-grid">
                        <div><label>Quantidade *</label><input type="number" id="venda-quantidade" min="1" value="1" required oninput="calcularTotalVenda()"></div>
                        <div><label>Valor Unit√°rio *</label><input type="text" id="venda-valor-unitario" readonly required style="background:#f9fafb"></div>
                    </div>
                    <div class="form-grid">
                        <div><label>Desconto (%)</label><input type="number" id="venda-desconto" min="0" max="100" value="0" oninput="calcularTotalVenda()"></div>
                        <div><label>Total *</label><input type="text" id="venda-total" readonly style="background:#ecfdf5;font-weight:bold;color:#059669;font-size:18px"></div>
                    </div>
                    <label>Forma de Pagamento *</label>
                    <select id="venda-pagamento" required>
                        <option value="">Selecione</option>
                        <option value="√Ä Vista">√Ä Vista</option>
                        <option value="Cart√£o">Cart√£o de Cr√©dito</option>
                        <option value="Boleto">Boleto</option>
                        <option value="30 dias">30 dias</option>
                        <option value="30/60 dias">30/60 dias</option>
                    </select>
                    <label>Observa√ß√µes</label>
                    <textarea id="venda-obs" rows="3"></textarea>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeModal('modalVenda')" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancelar</button>
                        <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">üíæ Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL NOVO CLIENTE -->
    <div id="modalCliente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal('modalCliente')">&times;</span>
                <h2 class="text-2xl font-bold" id="titulo-modal-cliente">üè• Novo Cliente</h2>
            </div>
            <div class="modal-body">
                <form id="formCliente" onsubmit="salvarCliente(event)">
                    <input type="hidden" id="cliente-id-edit">
                    <label>Nome *</label>
                    <input type="text" id="cliente-nome" required placeholder="Ex: Hospital S√£o Lucas">
                    <div class="form-grid">
                        <div><label>CNPJ *</label><input type="text" id="cliente-cnpj" required></div>
                        <div><label>Cidade *</label><input type="text" id="cliente-cidade" required></div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeModal('modalCliente')" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancelar</button>
                        <button type="submit" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">üíæ Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL NOVO PRODUTO -->
    <div id="modalProduto" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal('modalProduto')">&times;</span>
                <h2 class="text-2xl font-bold" id="titulo-modal-produto">ü©∫ Novo Produto</h2>
            </div>
            <div class="modal-body">
                <form id="formProduto" onsubmit="salvarProduto(event)">
                    <input type="hidden" id="produto-codigo-edit">
                    <label>C√≥digo *</label>
                    <input type="text" id="produto-codigo" required placeholder="Ex: MC-500">
                    <label>Nome *</label>
                    <input type="text" id="produto-nome" required placeholder="Ex: Monitor Card√≠aco">
                    <div class="form-grid">
                        <div><label>Categoria *</label>
                            <select id="produto-categoria" required>
                                <option value="">Selecione</option>
                                <option value="Monitoramento">Monitoramento</option>
                                <option value="Diagn√≥stico">Diagn√≥stico</option>
                                <option value="Cardiologia">Cardiologia</option>
                                <option value="Radiologia">Radiologia</option>
                                <option value="Emerg√™ncia">Emerg√™ncia</option>
                            </select>
                        </div>
                        <div><label>Quantidade *</label><input type="number" id="produto-quantidade" required min="0"></div>
                    </div>
                    <div class="form-grid">
                        <div><label>Custo *</label><input type="number" id="produto-custo" required step="0.01" min="0"></div>
                        <div><label>Pre√ßo Venda *</label><input type="number" id="produto-preco" required step="0.01" min="0"></div>
                    </div>
                    <div><label>Estoque M√≠nimo</label><input type="number" id="produto-estoque-minimo" value="5" min="0"></div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeModal('modalProduto')" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancelar</button>
                        <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">üíæ Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL GERAR DAV -->
    <div id="modalDAV" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal('modalDAV')">&times;</span>
                <h2 class="text-2xl font-bold">üìÑ Gerar DAV - Documento Auxiliar de Venda</h2>
            </div>
            <div class="modal-body">
                <form id="formDAV" onsubmit="finalizarDAV(event)">
                    <label>Cliente *</label>
                    <select id="dav-cliente" required><option value="">Selecione um cliente</option></select>
                    
                    <label>Representante *</label>
                    <select id="dav-representante" required><option value="">Selecione um representante</option></select>

                    <div style="border-top: 2px solid #e5e7eb; margin: 20px 0; padding-top: 20px;">
                        <label>Adicionar Produtos</label>
                        <div class="form-grid" style="margin-top: 10px;">
                            <div><select id="dav-produto-select"><option value="">Selecione produto</option></select></div>
                            <div style="display:flex; gap:10px;">
                                <input type="number" id="dav-quantidade-input" min="1" value="1" placeholder="Qtd" style="width:80px">
                                <button type="button" onclick="adicionarItemDAV()" class="btn-add">‚ûï Adicionar</button>
                            </div>
                        </div>
                    </div>

                    <div style="margin: 20px 0;">
                        <h4 style="font-weight: 700; color: #374151; margin-bottom: 10px;">Itens do DAV:</h4>
                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                            <table style="width: 100%; font-size: 14px;">
                                <thead style="background: #f9fafb;">
                                    <tr>
                                        <th style="padding: 10px; text-align: left;">Produto</th>
                                        <th style="padding: 10px; text-align: center;">Qtd</th>
                                        <th style="padding: 10px; text-align: right;">Pre√ßo Un.</th>
                                        <th style="padding: 10px; text-align: right;">Total</th>
                                        <th style="padding: 10px; text-align: center;">A√ß√£o</th>
                                    </tr>
                                </thead>
                                <tbody id="lista-itens-dav">
                                    <tr><td colspan="5" style="padding: 20px; text-align: center; color: #9ca3af;">Nenhum item adicionado</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 18px; font-weight: 700; color: #166534;">TOTAL DO DAV:</span>
                            <span id="dav-total-geral" style="font-size: 24px; font-weight: 700; color: #059669;">R$ 0,00</span>
                        </div>
                    </div>

                    <label>Condi√ß√µes de Pagamento</label>
                    <select id="dav-pagamento" required>
                        <option value="">Selecione</option>
                        <option value="√Ä Vista">√Ä Vista</option>
                        <option value="30 dias">30 dias</option>
                        <option value="30/60 dias">30/60 dias</option>
                        <option value="30/60/90 dias">30/60/90 dias</option>
                    </select>

                    <label>Observa√ß√µes</label>
                    <textarea id="dav-obs" rows="3" placeholder="Observa√ß√µes adicionais sobre o DAV..."></textarea>

                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="closeModal('modalDAV')" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancelar</button>
                        <button type="submit" class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">üìÑ Gerar DAV</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL DAV GERADO -->
    <div id="modalDAVGerado" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal('modalDAVGerado')">&times;</span>
                <h2 class="text-2xl font-bold">‚úÖ DAV Gerado com Sucesso!</h2>
            </div>
            <div class="modal-body">
                <div id="dav-gerado-conteudo" style="background: #f9fafb; padding: 20px; border-radius: 10px; margin-bottom: 20px; font-family: monospace; white-space: pre-wrap;"></div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107; margin-bottom: 20px;">
                    <p style="margin: 0; color: #856404; font-weight: 600;">üí° O que voc√™ deseja fazer com este DAV?</p>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <button onclick="imprimirDAV()" class="btn-action btn-print flex items-center justify-center space-x-2">
                        <span>üñ®Ô∏è</span><span>Imprimir</span>
                    </button>
                    <button onclick="baixarDAVPDF()" class="btn-action btn-pdf flex items-center justify-center space-x-2">
                        <span>üìÑ</span><span>Baixar PDF</span>
                    </button>
                    <button onclick="enviarDAVEmail()" class="btn-action btn-email flex items-center justify-center space-x-2">
                        <span>üìß</span><span>Enviar Email</span>
                    </button>
                    <button onclick="enviarDAVWhatsApp()" class="btn-action btn-whatsapp flex items-center justify-center space-x-2">
                        <span>üí¨</span><span>WhatsApp</span>
                    </button>
                </div>

                <div class="flex justify-end mt-6">
                    <button onclick="closeModal('modalDAVGerado')" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Fechar</button>
                </div>
            </div>
        </div>
    </div>

<script>
// ========================================
// PROHOSPITALAR - DADOS DO SISTEMA v5.0
// ========================================

let vendas = [];
let produtos = [];
let clientes = [];
let representantes = [];
let fornecedores = [];
let transacoes = [];
let contasReceber = [];
let itensDAV = [];
let historicoDAVs = [];
let davAtual = null;
let chartVendas = null;
    <!-- ========================================
     PARTE A - MODAIS REPRESENTANTE E FORNECEDOR
     Cole ANTES da tag <script> (depois do Modal Produto)
     ======================================== -->

<!-- MODAL REPRESENTANTE -->
<div id="modalRepresentante" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="close" onclick="closeModal('modalRepresentante')">&times;</span>
            <h2 class="text-2xl font-bold" id="titulo-modal-representante">üë®‚Äçüíº Novo Representante</h2>
        </div>
        <div class="modal-body">
            <form id="formRepresentante" onsubmit="salvarRepresentante(event)">
                <input type="hidden" id="representante-id-edit">
                
                <label>Nome Completo *</label>
                <input type="text" id="representante-nome" required placeholder="Ex: Jo√£o da Silva">
                
                <div class="form-grid">
                    <div>
                        <label>CPF *</label>
                        <input type="text" id="representante-cpf" required placeholder="000.000.000-00">
                    </div>
                    <div>
                        <label>Telefone *</label>
                        <input type="text" id="representante-telefone" required placeholder="(11) 99999-9999">
                    </div>
                </div>
                
                <div class="form-grid">
                    <div>
                        <label>Email *</label>
                        <input type="email" id="representante-email" required placeholder="email@exemplo.com">
                    </div>
                    <div>
                        <label>Regi√£o *</label>
                        <select id="representante-regiao" required>
                            <option value="">Selecione</option>
                            <option value="Norte">Norte</option>
                            <option value="Nordeste">Nordeste</option>
                            <option value="Centro-Oeste">Centro-Oeste</option>
                            <option value="Sudeste">Sudeste</option>
                            <option value="Sul">Sul</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div>
                        <label>Meta Mensal (R$) *</label>
                        <input type="number" id="representante-meta" required step="0.01" min="0" placeholder="200000.00">
                    </div>
                    <div>
                        <label>Comiss√£o (%) *</label>
                        <input type="number" id="representante-comissao" required step="0.01" min="0" max="100" value="5" placeholder="5.00">
                    </div>
                </div>
                
                <label>Observa√ß√µes</label>
                <textarea id="representante-obs" rows="3" placeholder="Informa√ß√µes adicionais sobre o representante..."></textarea>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeModal('modalRepresentante')" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">üíæ Salvar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- MODAL FORNECEDOR -->
<div id="modalFornecedor" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="close" onclick="closeModal('modalFornecedor')">&times;</span>
            <h2 class="text-2xl font-bold" id="titulo-modal-fornecedor">üè≠ Novo Fornecedor</h2>
        </div>
        <div class="modal-body">
            <form id="formFornecedor" onsubmit="salvarFornecedor(event)">
                <input type="hidden" id="fornecedor-id-edit">
                
                <label>Raz√£o Social *</label>
                <input type="text" id="fornecedor-nome" required placeholder="Ex: MedTech Equipamentos Ltda">
                
                <div class="form-grid">
                    <div>
                        <label>CNPJ *</label>
                        <input type="text" id="fornecedor-cnpj" required placeholder="00.000.000/0001-00">
                    </div>
                    <div>
                        <label>Inscri√ß√£o Estadual</label>
                        <input type="text" id="fornecedor-ie" placeholder="000.000.000.000">
                    </div>
                </div>
                
                <div class="form-grid">
                    <div>
                        <label>Telefone *</label>
                        <input type="text" id="fornecedor-telefone" required placeholder="(11) 3333-3333">
                    </div>
                    <div>
                        <label>Email *</label>
                        <input type="email" id="fornecedor-email" required placeholder="contato@fornecedor.com">
                    </div>
                </div>
                
                <label>Especialidade *</label>
                <select id="fornecedor-especialidade" required>
                    <option value="">Selecione</option>
                    <option value="Equipamentos de Diagn√≥stico">Equipamentos de Diagn√≥stico</option>
                    <option value="Equipamentos de Monitoramento">Equipamentos de Monitoramento</option>
                    <option value="Equipamentos de Cirurgia">Equipamentos de Cirurgia</option>
                    <option value="Mobili√°rio Hospitalar">Mobili√°rio Hospitalar</option>
                    <option value="Equipamentos de Imagem">Equipamentos de Imagem</option>
                    <option value="Equipamentos de Emerg√™ncia">Equipamentos de Emerg√™ncia</option>
                    <option value="Outros">Outros</option>
                </select>
                
                <div class="form-grid">
                    <div>
                        <label>Cidade *</label>
                        <input type="text" id="fornecedor-cidade" required placeholder="S√£o Paulo">
                    </div>
                    <div>
                        <label>Estado *</label>
                        <select id="fornecedor-estado" required>
                            <option value="">Selecione</option>
                            <option value="AC">AC</option>
                            <option value="AL">AL</option>
                            <option value="AP">AP</option>
                            <option value="AM">AM</option>
                            <option value="BA">BA</option>
                            <option value="CE">CE</option>
                            <option value="DF">DF</option>
                            <option value="ES">ES</option>
                            <option value="GO">GO</option>
                            <option value="MA">MA</option>
                            <option value="MT">MT</option>
                            <option value="MS">MS</option>
                            <option value="MG">MG</option>
                            <option value="PA">PA</option>
                            <option value="PB">PB</option>
                            <option value="PR">PR</option>
                            <option value="PE">PE</option>
                            <option value="PI">PI</option>
                            <option value="RJ">RJ</option>
                            <option value="RN">RN</option>
                            <option value="RS">RS</option>
                            <option value="RO">RO</option>
                            <option value="RR">RR</option>
                            <option value="SC">SC</option>
                            <option value="SP">SP</option>
                            <option value="SE">SE</option>
                            <option value="TO">TO</option>
                        </select>
                    </div>
                </div>
                
                <label>Observa√ß√µes</label>
                <textarea id="fornecedor-obs" rows="3" placeholder="Informa√ß√µes adicionais sobre o fornecedor..."></textarea>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeModal('modalFornecedor')" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">üíæ Salvar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ========================================
     FIM DA PARTE A
     Agora aguarde a PARTE B (JavaScript)
     ======================================== -->
         // ========================================
// BACKUP E PERSIST√äNCIA (NOVO!)
// ========================================

function salvarDados() {
    try {
        const dados = {
            vendas,
            produtos,
            clientes,
            representantes,
            fornecedores,
            transacoes,
            contasReceber,
            historicoDAVs,
            ultimoBackup: new Date().toLocaleString('pt-BR')
        };
        localStorage.setItem('prohospitalar_dados', JSON.stringify(dados));
        document.getElementById('ultimo-backup').textContent = 'Agora mesmo';
        return true;
    } catch (e) {
        console.error('Erro ao salvar dados:', e);
        return false;
    }
}

function carregarDados() {
    try {
        const dadosSalvos = localStorage.getItem('prohospitalar_dados');
        if (dadosSalvos) {
            const dados = JSON.parse(dadosSalvos);
            vendas = dados.vendas || [];
            produtos = dados.produtos || [];
            clientes = dados.clientes || [];
            representantes = dados.representantes || [];
            fornecedores = dados.fornecedores || [];
            transacoes = dados.transacoes || [];
            contasReceber = dados.contasReceber || [];
            historicoDAVs = dados.historicoDAVs || [];
            
            if (dados.ultimoBackup) {
                document.getElementById('ultimo-backup').textContent = dados.ultimoBackup;
            }
            
            console.log('‚úÖ Dados carregados do backup!');
            return true;
        } else {
            carregarDadosIniciais();
            console.log('‚úÖ Dados iniciais carregados!');
            return false;
        }
    } catch (e) {
        console.error('Erro ao carregar dados:', e);
        carregarDadosIniciais();
        return false;
    }
}

function carregarDadosIniciais() {
    vendas = [
        { id: 1, data: '2024-10-17', cliente: 'Hospital S√£o Lucas', produto: 'Monitor Card√≠aco MC-500', codigoProduto: 'MC-500', quantidade: 1, representante: 'Ana Silva', valor: 45890, lucro: 15200, status: 'Conclu√≠da', pagamento: '√Ä Vista' },
        { id: 2, data: '2024-10-17', cliente: 'Cl√≠nica Santa Maria', produto: 'Ultrassom US-300', codigoProduto: 'US-300', quantidade: 1, representante: 'Carlos Mendes', valor: 78500, lucro: 28900, status: 'Conclu√≠da', pagamento: 'Boleto' }
    ];

    produtos = [
        { codigo: 'MC-500', nome: 'Monitor Card√≠aco Digital', categoria: 'Monitoramento', quantidade: 12, custo: 30690, precoVenda: 45890, estoqueMinimo: 5, status: 'Dispon√≠vel' },
        { codigo: 'US-300', nome: 'Ultrassom Port√°til', categoria: 'Diagn√≥stico', quantidade: 5, custo: 49600, precoVenda: 78500, estoqueMinimo: 3, status: 'Dispon√≠vel' },
        { codigo: 'RX-700', nome: 'Equipamento Raio-X Digital', categoria: 'Radiologia', quantidade: 3, custo: 83000, precoVenda: 125000, estoqueMinimo: 2, status: 'Dispon√≠vel' }
    ];

    clientes = [
        { id: 1, nome: 'Hospital S√£o Lucas', cnpj: '12.345.678/0001-90', cidade: 'S√£o Paulo', status: 'Ativo' },
        { id: 2, nome: 'Cl√≠nica Santa Maria', cnpj: '23.456.789/0001-01', cidade: 'Rio de Janeiro', status: 'Ativo' }
    ];

    representantes = [
        { id: 1, nome: 'Ana Silva', regiao: 'Sudeste', vendasMes: 249390, meta: 220000, performance: '113%' },
        { id: 2, nome: 'Carlos Mendes', regiao: 'Sul', vendasMes: 187600, meta: 200000, performance: '94%' }
    ];

    fornecedores = [
        { id: 1, nome: 'MedTech Equipamentos', cnpj: '56.789.012/0001-34', especialidade: 'Equipamentos de Diagn√≥stico', status: 'Ativo' }
    ];

    transacoes = [
        { id: 1, data: '2024-10-17', descricao: 'Venda - Hospital S√£o Lucas', tipo: 'Entrada', valor: 45890, status: 'Confirmado' }
    ];

    contasReceber = [];
    historicoDAVs = [];
}

function fazerBackupManual() {
    if (salvarDados()) {
        alert('‚úÖ BACKUP REALIZADO!\n\nTodos os dados foram salvos com sucesso!\n\nüíæ Local: Navegador (localStorage)\nüìÖ Data: ' + new Date().toLocaleString('pt-BR'));
    } else {
        alert('‚ùå ERRO AO FAZER BACKUP!\n\nN√£o foi poss√≠vel salvar os dados.');
    }
}

// ========================================
// CONTROLE DE ESTOQUE AUTOM√ÅTICO (NOVO!)
// ========================================

function baixarEstoque(codigoProduto, quantidade) {
    const produto = produtos.find(p => p.codigo === codigoProduto);
    if (produto) {
        produto.quantidade -= quantidade;
        if (produto.quantidade < 0) produto.quantidade = 0;
        verificarEstoqueBaixo();
        salvarDados();
        return true;
    }
    return false;
}

function devolverEstoque(codigoProduto, quantidade) {
    const produto = produtos.find(p => p.codigo === codigoProduto);
    if (produto) {
        produto.quantidade += quantidade;
        verificarEstoqueBaixo();
        salvarDados();
        return true;
    }
    return false;
}

function verificarEstoqueBaixo() {
    const produtosBaixos = produtos.filter(p => p.quantidade <= (p.estoqueMinimo || 5));
    const countBaixos = produtosBaixos.length;
    
    document.getElementById('estoque-baixo').textContent = countBaixos;
    document.getElementById('dash-estoque-baixo').textContent = countBaixos;
    
    if (countBaixos > 0) {
        const alerta = document.getElementById('alerta-estoque-baixo');
        if (alerta) {
            alerta.innerHTML = `
                <div class="alerta-estoque mb-4">
                    <div class="flex items-start">
                        <span class="text-2xl mr-3">‚ö†Ô∏è</span>
                        <div class="flex-1">
                            <h4 class="font-bold text-orange-800 mb-2">Aten√ß√£o: ${countBaixos} produto(s) com estoque baixo!</h4>
                            <ul class="text-sm text-orange-700">
                                ${produtosBaixos.map(p => `<li>‚Ä¢ ${p.nome} (${p.codigo}): ${p.quantidade} unidades</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }
    } else {
        const alerta = document.getElementById('alerta-estoque-baixo');
        if (alerta) alerta.innerHTML = '';
    }
}

// ========================================
// CONTAS A RECEBER (NOVO!)
// ========================================

function gerarContaReceber(venda) {
    if (venda.pagamento !== '√Ä Vista') {
        let diasVencimento = 30;
        if (venda.pagamento === '30/60 dias') diasVencimento = 30;
        
        const dataVencimento = new Date(venda.data);
        dataVencimento.setDate(dataVencimento.getDate() + diasVencimento);
        
        const conta = {
            id: contasReceber.length + 1,
            vendaId: venda.id,
            cliente: venda.cliente,
            valor: venda.valor,
            dataVencimento: dataVencimento.toISOString().split('T')[0],
            status: 'Pendente',
            dataPagamento: null
        };
        
        contasReceber.push(conta);
        salvarDados();
        atualizarContadores();
    }
}

function marcarComoPago(contaId) {
    const conta = contasReceber.find(c => c.id === contaId);
    if (conta) {
        conta.status = 'Pago';
        conta.dataPagamento = new Date().toISOString().split('T')[0];
        salvarDados();
        alert('‚úÖ Conta marcada como paga!');
        renderContasReceber();
        atualizarContadores();
    }
}

function calcularTotaisReceber() {
    const totalReceber = contasReceber.filter(c => c.status === 'Pendente').reduce((sum, c) => sum + c.valor, 0);
    const hoje = new Date().toISOString().split('T')[0];
    const totalVencidas = contasReceber.filter(c => c.status === 'Pendente' && c.dataVencimento < hoje).reduce((sum, c) => sum + c.valor, 0);
    const totalRecebido = contasReceber.filter(c => c.status === 'Pago').reduce((sum, c) => sum + c.valor, 0);
    
    return { totalReceber, totalVencidas, totalRecebido };
}

// ========================================
// FUN√á√ïES DE NAVEGA√á√ÉO
// ========================================

function showTab(tabName) {
    const tabs = ['dashboard', 'vendas', 'contas-receber', 'clientes', 'estoque', 'vendedores', 'fornecedores', 'financeiro', 'historico-davs'];
    
    tabs.forEach(tab => {
        const element = document.getElementById(tab);
        if (element) element.classList.add('hidden');
        
        const tabButton = document.getElementById(`tab-${tab}`);
        if (tabButton) {
            tabButton.classList.remove('active-tab');
            tabButton.classList.add('text-gray-700', 'hover:bg-gray-100');
        }
    });

    const selectedTab = document.getElementById(tabName);
    if (selectedTab) {
        selectedTab.classList.remove('hidden');
        selectedTab.classList.add('fade-in');
    }
    
    const selectedButton = document.getElementById(`tab-${tabName}`);
    if (selectedButton) {
        selectedButton.classList.add('active-tab');
        selectedButton.classList.remove('text-gray-700', 'hover:bg-gray-100');
    }

    if (tabName === 'dashboard') initDashboard();
    else if (tabName === 'vendas') renderVendas();
    else if (tabName === 'contas-receber') renderContasReceber();
    else if (tabName === 'clientes') renderClientes();
    else if (tabName === 'estoque') renderProdutos();
    else if (tabName === 'vendedores') renderRepresentantes();
    else if (tabName === 'fornecedores') renderFornecedores();
    else if (tabName === 'financeiro') renderFinanceiro();
    else if (tabName === 'historico-davs') renderHistoricoDAVs();
}

// ========================================
// DASHBOARD E CONTADORES
// ========================================

function initDashboard() {
    atualizarContadores();
    verificarEstoqueBaixo();
    
    const ctx = document.getElementById('chartVendasCategorias');
    if (ctx && !chartVendas) {
        chartVendas = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out'],
                datasets: [{
                    label: 'Vendas (R$)',
                    data: [245000, 289000, 312000, 278000, 356000, 398000, 367000, 425000, 489000, 685490],
                    borderColor: '#059669',
                    backgroundColor: 'rgba(5, 150, 105, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: { legend: { display: true } },
                scales: {
                    y: { 
                        beginAtZero: true,
                        ticks: { callback: value => 'R$ ' + value.toLocaleString('pt-BR') }
                    }
                }
            }
        });
    }
}

function atualizarContadores() {
    const totalVendas = vendas.reduce((sum, v) => sum + v.valor, 0);
    const { totalReceber, totalVencidas } = calcularTotaisReceber();
    const contasPendentes = contasReceber.filter(c => c.status === 'Pendente').length;
    const produtosBaixos = produtos.filter(p => p.quantidade <= (p.estoqueMinimo || 5)).length;
    
    document.getElementById('dash-vendas').textContent = 'R$ ' + totalVendas.toLocaleString('pt-BR');
    document.getElementById('dash-receber').textContent = 'R$ ' + totalReceber.toLocaleString('pt-BR');
    document.getElementById('dash-clientes').textContent = clientes.length;
    document.getElementById('dash-produtos').textContent = produtos.length;
    document.getElementById('dash-estoque-baixo').textContent = produtosBaixos;
    document.getElementById('receber-count').textContent = contasPendentes;
    document.getElementById('alert-count').textContent = contasPendentes + produtosBaixos;
}

// ========================================
// RENDERIZAR TABELAS
// ========================================

function renderVendas() {
    const tbody = document.getElementById('lista-vendas');
    if (!tbody) return;
    
    tbody.innerHTML = vendas.map(venda => {
        const statusColor = venda.status === 'Conclu√≠da' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
        return `
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 text-sm">${new Date(venda.data).toLocaleDateString('pt-BR')}</td>
                <td class="px-6 py-4">${venda.cliente}</td>
                <td class="px-6 py-4 text-sm">${venda.produto}</td>
                <td class="px-6 py-4 font-semibold text-green-600">R$ ${venda.valor.toLocaleString('pt-BR')}</td>
                <td class="px-6 py-4"><span class="px-2 py-1 text-xs rounded-full ${statusColor}">${venda.status}</span></td>
                <td class="px-6 py-4">
                    <button onclick="editarVenda(${venda.id})" class="btn-edit">‚úèÔ∏è Editar</button>
                    <button onclick="deletarVenda(${venda.id})" class="btn-delete">üóëÔ∏è Deletar</button>
                </td>
            </tr>
        `;
    }).join('');
}

function renderContasReceber() {
    const tbody = document.getElementById('lista-contas-receber');
    if (!tbody) return;
    
    const { totalReceber, totalVencidas, totalRecebido } = calcularTotaisReceber();
    document.getElementById('total-receber').textContent = 'R$ ' + totalReceber.toLocaleString('pt-BR', {minimumFractionDigits: 2});
    document.getElementById('total-vencidas').textContent = 'R$ ' + totalVencidas.toLocaleString('pt-BR', {minimumFractionDigits: 2});
    document.getElementById('total-recebido').textContent = 'R$ ' + totalRecebido.toLocaleString('pt-BR', {minimumFractionDigits: 2});
    
    if (contasReceber.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-500">Nenhuma conta a receber cadastrada.</td></tr>';
        return;
    }
    
    const hoje = new Date().toISOString().split('T')[0];
    
    tbody.innerHTML = contasReceber.map(conta => {
        const statusColor = conta.status === 'Pago' ? 'bg-green-100 text-green-800' : 
                           (conta.dataVencimento < hoje ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800');
        const statusTexto = conta.status === 'Pago' ? 'Pago' : (conta.dataVencimento < hoje ? 'Vencida' : 'Pendente');
        
        return `
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 font-medium">#${conta.vendaId}</td>
                <td class="px-6 py-4">${conta.cliente}</td>
                <td class="px-6 py-4 text-sm">${new Date(conta.dataVencimento).toLocaleDateString('pt-BR')}</td>
                <td class="px-6 py-4 font-semibold text-green-600">R$ ${conta.valor.toLocaleString('pt-BR')}</td>
                <td class="px-6 py-4"><span class="px-2 py-1 text-xs rounded-full ${statusColor}">${statusTexto}</span></td>
                <td class="px-6 py-4">
                    ${conta.status === 'Pendente' ? `<button onclick="marcarComoPago(${conta.id})" class="btn-pagar">‚úÖ Receber</button>` : '<span class="text-sm text-green-600">‚úì Recebido</span>'}
                </td>
            </tr>
        `;
    }).join('');
}

function renderClientes() {
    const tbody = document.getElementById('lista-clientes');
    if (!tbody) return;
    
    tbody.innerHTML = clientes.map(cliente => `
        <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 font-medium">${cliente.nome}</td>
            <td class="px-6 py-4 text-sm">${cliente.cnpj}</td>
            <td class="px-6 py-4 text-sm">${cliente.cidade}</td>
            <td class="px-6 py-4">
                <button onclick="editarCliente(${cliente.id})" class="btn-edit">‚úèÔ∏è Editar</button>
                <button onclick="deletarCliente(${cliente.id})" class="btn-delete">üóëÔ∏è Deletar</button>
            </td>
        </tr>
    `).join('');
}

function renderProdutos() {
    const tbody = document.getElementById('lista-produtos');
    if (!tbody) return;
    
    verificarEstoqueBaixo();
    
    tbody.innerHTML = produtos.map(produto => {
        const estoqueClasse = produto.quantidade <= (produto.estoqueMinimo || 5) ? 'text-red-600 font-bold' : 'font-semibold';
        return `
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 font-medium">${produto.codigo}</td>
                <td class="px-6 py-4">${produto.nome}</td>
                <td class="px-6 py-4 text-center ${estoqueClasse}">${produto.quantidade}</td>
                <td class="px-6 py-4 font-semibold">R$ ${produto.precoVenda.toLocaleString('pt-BR')}</td>
                <td class="px-6 py-4">
                    <button onclick="editarProduto('${produto.codigo}')" class="btn-edit">‚úèÔ∏è Editar</button>
                    <button onclick="deletarProduto('${produto.codigo}')" class="btn-delete">üóëÔ∏è Deletar</button>
                </td>
            </tr>
        `;
    }).join('');
}

function renderRepresentantes() {
    const tbody = document.getElementById('lista-representantes');
    if (!tbody) return;
    
    tbody.innerHTML = representantes.map(rep => `
        <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 font-medium">${rep.nome}</td>
            <td class="px-6 py-4 text-sm">${rep.regiao}</td>
            <td class="px-6 py-4 font-semibold text-green-600">R$ ${rep.vendasMes.toLocaleString('pt-BR')}</td>
            <td class="px-6 py-4">
                <button onclick="alert('Em desenvolvimento')" class="btn-edit">‚úèÔ∏è Editar</button>
            </td>
        </tr>
    `).join('');
}

function renderFornecedores() {
    const tbody = document.getElementById('lista-fornecedores');
    if (!tbody) return;
    
    tbody.innerHTML = fornecedores.map(forn => `
        <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 font-medium">${forn.nome}</td>
            <td class="px-6 py-4 text-sm">${forn.cnpj}</td>
            <td class="px-6 py-4 text-sm">${forn.especialidade}</td>
            <td class="px-6 py-4">
                <button onclick="alert('Em desenvolvimento')" class="btn-edit">‚úèÔ∏è Editar</button>
            </td>
        </tr>
    `).join('');
}

function renderFinanceiro() {
    const tbody = document.getElementById('lista-transacoes');
    if (!tbody) return;
    
    tbody.innerHTML = transacoes.map(trans => {
        const tipoColor = trans.tipo === 'Entrada' ? 'text-green-600' : 'text-red-600';
        return `
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 text-sm">${new Date(trans.data).toLocaleDateString('pt-BR')}</td>
                <td class="px-6 py-4">${trans.descricao}</td>
                <td class="px-6 py-4 font-semibold ${tipoColor}">R$ ${trans.valor.toLocaleString('pt-BR')}</td>
            </tr>
        `;
    }).join('');
}

function renderHistoricoDAVs() {
    const tbody = document.getElementById('lista-historico-davs');
    if (!tbody) return;
    
    if (historicoDAVs.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-500">Nenhum DAV gerado ainda.</td></tr>';
        return;
    }
    
    tbody.innerHTML = historicoDAVs.map(dav => `
        <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 font-medium">${dav.numero}</td>
            <td class="px-6 py-4 text-sm">${new Date(dav.data).toLocaleDateString('pt-BR')}</td>
            <td class="px-6 py-4">${dav.cliente}</td>
            <td class="px-6 py-4 font-semibold text-green-600">R$ ${dav.total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
            <td class="px-6 py-4"><span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">${dav.status}</span></td>
            <td class="px-6 py-4">
                <button onclick="visualizarDAV('${dav.numero}')" class="btn-edit">üëÅÔ∏è Ver</button>
                <button onclick="reimprimirDAV('${dav.numero}')" class="btn-edit">üñ®Ô∏è</button>
                <button onclick="deletarDAV('${dav.numero}')" class="btn-delete">üóëÔ∏è</button>
            </td>
        </tr>
    `).join('');
}
    // ========================================
// MODAIS - ABRIR E FECHAR
// ========================================

function openModal(tipo) {
    if (tipo === 'venda') {
        document.getElementById('modalVenda').style.display = 'block';
        document.getElementById('titulo-modal-venda').textContent = 'üí∞ Nova Venda';
        document.getElementById('venda-id-edit').value = '';
        popularSelectsVenda();
        document.getElementById('formVenda').reset();
    } else if (tipo === 'cliente') {
        document.getElementById('modalCliente').style.display = 'block';
        document.getElementById('titulo-modal-cliente').textContent = 'üè• Novo Cliente';
        document.getElementById('cliente-id-edit').value = '';
        document.getElementById('formCliente').reset();
    } else if (tipo === 'produto') {
        document.getElementById('modalProduto').style.display = 'block';
        document.getElementById('titulo-modal-produto').textContent = 'ü©∫ Novo Produto';
        document.getElementById('produto-codigo-edit').value = '';
        document.getElementById('formProduto').reset();
    } else if (tipo === 'dav') {
        document.getElementById('modalDAV').style.display = 'block';
        popularSelectsDAV();
        itensDAV = [];
        atualizarTabelaDAV();
    }
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
    }
}

// ========================================
// VENDAS - CRUD COMPLETO COM ESTOQUE
// ========================================

function popularSelectsVenda() {
    const selectCliente = document.getElementById('venda-cliente');
    const selectProduto = document.getElementById('venda-produto');
    const selectRep = document.getElementById('venda-representante');
    
    selectCliente.innerHTML = '<option value="">Selecione</option>' + 
        clientes.map(c => `<option value="${c.nome}">${c.nome}</option>`).join('');
    
    selectProduto.innerHTML = '<option value="">Selecione</option>' + 
        produtos.map(p => `<option value="${p.codigo}" data-nome="${p.nome}" data-preco="${p.precoVenda}" data-qtd="${p.quantidade}">${p.nome} - R$ ${p.precoVenda.toLocaleString('pt-BR')} (Est: ${p.quantidade})</option>`).join('');
    
    selectRep.innerHTML = '<option value="">Selecione</option>' + 
        representantes.map(r => `<option value="${r.nome}">${r.nome} - ${r.regiao}</option>`).join('');
}

function atualizarPrecoVenda() {
    const select = document.getElementById('venda-produto');
    const selectedOption = select.options[select.selectedIndex];
    const preco = selectedOption.getAttribute('data-preco');
    const qtdDisponivel = selectedOption.getAttribute('data-qtd');
    
    if (preco) {
        document.getElementById('venda-valor-unitario').value = 'R$ ' + parseFloat(preco).toLocaleString('pt-BR', {minimumFractionDigits: 2});
        document.getElementById('venda-quantidade').max = qtdDisponivel;
        calcularTotalVenda();
    }
}

function calcularTotalVenda() {
    const select = document.getElementById('venda-produto');
    const selectedOption = select.options[select.selectedIndex];
    const preco = parseFloat(selectedOption.getAttribute('data-preco')) || 0;
    const quantidade = parseInt(document.getElementById('venda-quantidade').value) || 0;
    const desconto = parseFloat(document.getElementById('venda-desconto').value) || 0;
    
    const subtotal = preco * quantidade;
    const valorDesconto = subtotal * (desconto / 100);
    const total = subtotal - valorDesconto;
    
    document.getElementById('venda-total').value = 'R$ ' + total.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
}

function salvarVenda(event) {
    event.preventDefault();
    
    const idEdit = document.getElementById('venda-id-edit').value;
    const select = document.getElementById('venda-produto');
    const selectedOption = select.options[select.selectedIndex];
    const codigoProduto = select.value;
    const preco = parseFloat(selectedOption.getAttribute('data-preco')) || 0;
    const quantidade = parseInt(document.getElementById('venda-quantidade').value);
    const desconto = parseFloat(document.getElementById('venda-desconto').value) || 0;
    const qtdDisponivel = parseInt(selectedOption.getAttribute('data-qtd'));
    
    if (quantidade > qtdDisponivel) {
        alert('‚ö†Ô∏è ESTOQUE INSUFICIENTE!\n\nQuantidade dispon√≠vel: ' + qtdDisponivel);
        return;
    }
    
    const subtotal = preco * quantidade;
    const valorDesconto = subtotal * (desconto / 100);
    const total = subtotal - valorDesconto;
    
    if (idEdit) {
        const index = vendas.findIndex(v => v.id == idEdit);
        if (index !== -1) {
            const vendaAntiga = vendas[index];
            devolverEstoque(vendaAntiga.codigoProduto, vendaAntiga.quantidade);
            
            vendas[index].cliente = document.getElementById('venda-cliente').value;
            vendas[index].produto = selectedOption.getAttribute('data-nome');
            vendas[index].codigoProduto = codigoProduto;
            vendas[index].quantidade = quantidade;
            vendas[index].representante = document.getElementById('venda-representante').value;
            vendas[index].valor = total;
            vendas[index].pagamento = document.getElementById('venda-pagamento').value;
            vendas[index].lucro = total * 0.35;
            
            baixarEstoque(codigoProduto, quantidade);
            alert('‚úÖ Venda atualizada com sucesso!\n\nüì¶ Estoque atualizado automaticamente!');
        }
    } else {
        const novaVenda = {
            id: vendas.length > 0 ? Math.max(...vendas.map(v => v.id)) + 1 : 1,
            data: new Date().toISOString().split('T')[0],
            cliente: document.getElementById('venda-cliente').value,
            produto: selectedOption.getAttribute('data-nome'),
            codigoProduto: codigoProduto,
            quantidade: quantidade,
            representante: document.getElementById('venda-representante').value,
            valor: total,
            lucro: total * 0.35,
            status: 'Conclu√≠da',
            pagamento: document.getElementById('venda-pagamento').value
        };
        
        vendas.unshift(novaVenda);
        baixarEstoque(codigoProduto, quantidade);
        gerarContaReceber(novaVenda);
        
        alert('‚úÖ Venda cadastrada com sucesso!\n\nüì¶ Estoque atualizado: -' + quantidade + ' unidades\nüí∞ Total: R$ ' + total.toLocaleString('pt-BR', {minimumFractionDigits: 2}));
    }
    
    salvarDados();
    closeModal('modalVenda');
    document.getElementById('formVenda').reset();
    showTab('vendas');
}

function editarVenda(id) {
    const venda = vendas.find(v => v.id === id);
    if (!venda) return;
    
    document.getElementById('modalVenda').style.display = 'block';
    document.getElementById('titulo-modal-venda').textContent = '‚úèÔ∏è Editar Venda';
    document.getElementById('venda-id-edit').value = venda.id;
    popularSelectsVenda();
    document.getElementById('venda-cliente').value = venda.cliente;
    document.getElementById('venda-representante').value = venda.representante;
    document.getElementById('venda-pagamento').value = venda.pagamento;
    document.getElementById('venda-quantidade').value = venda.quantidade || 1;
    document.getElementById('venda-desconto').value = 0;
}

function deletarVenda(id) {
    if (!confirm('‚ö†Ô∏è Tem certeza que deseja deletar esta venda?\n\nO estoque ser√° devolvido automaticamente!')) return;
    
    const venda = vendas.find(v => v.id === id);
    if (venda) {
        devolverEstoque(venda.codigoProduto, venda.quantidade);
        
        const contaRelacionada = contasReceber.find(c => c.vendaId === id);
        if (contaRelacionada) {
            contasReceber = contasReceber.filter(c => c.vendaId !== id);
        }
    }
    
    vendas = vendas.filter(v => v.id !== id);
    salvarDados();
    alert('‚úÖ Venda deletada!\n\nüì¶ Estoque devolvido automaticamente!');
    renderVendas();
    atualizarContadores();
}

// ========================================
// CLIENTES - CRUD
// ========================================

function salvarCliente(event) {
    event.preventDefault();
    
    const idEdit = document.getElementById('cliente-id-edit').value;
    
    if (idEdit) {
        const index = clientes.findIndex(c => c.id == idEdit);
        if (index !== -1) {
            clientes[index].nome = document.getElementById('cliente-nome').value;
            clientes[index].cnpj = document.getElementById('cliente-cnpj').value;
            clientes[index].cidade = document.getElementById('cliente-cidade').value;
            alert('‚úÖ Cliente atualizado!');
        }
    } else {
        const novoCliente = {
            id: clientes.length > 0 ? Math.max(...clientes.map(c => c.id)) + 1 : 1,
            nome: document.getElementById('cliente-nome').value,
            cnpj: document.getElementById('cliente-cnpj').value,
            cidade: document.getElementById('cliente-cidade').value,
            status: 'Ativo'
        };
        clientes.push(novoCliente);
        alert('‚úÖ Cliente cadastrado!');
    }
    
    salvarDados();
    closeModal('modalCliente');
    document.getElementById('formCliente').reset();
    showTab('clientes');
}

function editarCliente(id) {
    const cliente = clientes.find(c => c.id === id);
    if (!cliente) return;
    
    document.getElementById('modalCliente').style.display = 'block';
    document.getElementById('titulo-modal-cliente').textContent = '‚úèÔ∏è Editar Cliente';
    document.getElementById('cliente-id-edit').value = cliente.id;
    document.getElementById('cliente-nome').value = cliente.nome;
    document.getElementById('cliente-cnpj').value = cliente.cnpj;
    document.getElementById('cliente-cidade').value = cliente.cidade;
}

function deletarCliente(id) {
    if (confirm('‚ö†Ô∏è Deletar este cliente?')) {
        clientes = clientes.filter(c => c.id !== id);
        salvarDados();
        alert('‚úÖ Cliente deletado!');
        renderClientes();
    }
}

// ========================================
// PRODUTOS - CRUD
// ========================================

function salvarProduto(event) {
    event.preventDefault();
    
    const codigoEdit = document.getElementById('produto-codigo-edit').value;
    
    if (codigoEdit) {
        const index = produtos.findIndex(p => p.codigo === codigoEdit);
        if (index !== -1) {
            produtos[index].codigo = document.getElementById('produto-codigo').value;
            produtos[index].nome = document.getElementById('produto-nome').value;
            produtos[index].categoria = document.getElementById('produto-categoria').value;
            produtos[index].quantidade = parseInt(document.getElementById('produto-quantidade').value);
            produtos[index].custo = parseFloat(document.getElementById('produto-custo').value);
            produtos[index].precoVenda = parseFloat(document.getElementById('produto-preco').value);
            produtos[index].estoqueMinimo = parseInt(document.getElementById('produto-estoque-minimo').value);
            alert('‚úÖ Produto atualizado!');
        }
    } else {
        const novoProduto = {
            codigo: document.getElementById('produto-codigo').value,
            nome: document.getElementById('produto-nome').value,
            categoria: document.getElementById('produto-categoria').value,
            quantidade: parseInt(document.getElementById('produto-quantidade').value),
            custo: parseFloat(document.getElementById('produto-custo').value),
            precoVenda: parseFloat(document.getElementById('produto-preco').value),
            estoqueMinimo: parseInt(document.getElementById('produto-estoque-minimo').value),
            status: 'Dispon√≠vel'
        };
        produtos.push(novoProduto);
        alert('‚úÖ Produto cadastrado!');
    }
    
    verificarEstoqueBaixo();
    salvarDados();
    closeModal('modalProduto');
    document.getElementById('formProduto').reset();
    showTab('estoque');
}

function editarProduto(codigo) {
    const produto = produtos.find(p => p.codigo === codigo);
    if (!produto) return;
    
    document.getElementById('modalProduto').style.display = 'block';
    document.getElementById('titulo-modal-produto').textContent = '‚úèÔ∏è Editar Produto';
    document.getElementById('produto-codigo-edit').value = produto.codigo;
    document.getElementById('produto-codigo').value = produto.codigo;
    document.getElementById('produto-nome').value = produto.nome;
    document.getElementById('produto-categoria').value = produto.categoria;
    document.getElementById('produto-quantidade').value = produto.quantidade;
    document.getElementById('produto-custo').value = produto.custo;
    document.getElementById('produto-preco').value = produto.precoVenda;
    document.getElementById('produto-estoque-minimo').value = produto.estoqueMinimo || 5;
}

function deletarProduto(codigo) {
    if (confirm('‚ö†Ô∏è Deletar este produto?')) {
        produtos = produtos.filter(p => p.codigo !== codigo);
        salvarDados();
        alert('‚úÖ Produto deletado!');
        renderProdutos();
    }
}

// ========================================
// DAV - FUN√á√ïES COMPLETAS
// ========================================

function popularSelectsDAV() {
    const selectCliente = document.getElementById('dav-cliente');
    const selectRep = document.getElementById('dav-representante');
    const selectProduto = document.getElementById('dav-produto-select');
    
    selectCliente.innerHTML = '<option value="">Selecione</option>' + 
        clientes.map(c => `<option value="${c.nome}">${c.nome}</option>`).join('');
    
    selectRep.innerHTML = '<option value="">Selecione</option>' + 
        representantes.map(r => `<option value="${r.nome}">${r.nome} - ${r.regiao}</option>`).join('');
    
    selectProduto.innerHTML = '<option value="">Selecione</option>' + 
        produtos.map(p => `<option value="${p.codigo}" data-nome="${p.nome}" data-preco="${p.precoVenda}">${p.nome} - R$ ${p.precoVenda.toLocaleString('pt-BR')}</option>`).join('');
}

function adicionarItemDAV() {
    const select = document.getElementById('dav-produto-select');
    const quantidade = parseInt(document.getElementById('dav-quantidade-input').value);
    
    if (!select.value || quantidade <= 0) {
        alert('‚ö†Ô∏è Selecione um produto e quantidade v√°lida!');
        return;
    }
    
    const selectedOption = select.options[select.selectedIndex];
    const codigo = select.value;
    const nome = selectedOption.getAttribute('data-nome');
    const preco = parseFloat(selectedOption.getAttribute('data-preco'));
    const total = preco * quantidade;
    
    const itemExistente = itensDAV.find(item => item.codigo === codigo);
    if (itemExistente) {
        itemExistente.quantidade += quantidade;
        itemExistente.total = itemExistente.preco * itemExistente.quantidade;
    } else {
        itensDAV.push({ codigo, nome, quantidade, preco, total });
    }
    
    atualizarTabelaDAV();
    select.value = '';
    document.getElementById('dav-quantidade-input').value = '1';
}

function removerItemDAV(codigo) {
    itensDAV = itensDAV.filter(item => item.codigo !== codigo);
    atualizarTabelaDAV();
}

function atualizarTabelaDAV() {
    const tbody = document.getElementById('lista-itens-dav');
    
    if (itensDAV.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="padding: 20px; text-align: center; color: #9ca3af;">Nenhum item adicionado</td></tr>';
        document.getElementById('dav-total-geral').textContent = 'R$ 0,00';
        return;
    }
    
    tbody.innerHTML = itensDAV.map(item => `
        <tr style="border-bottom: 1px solid #e5e7eb;">
            <td style="padding: 12px;">${item.nome}</td>
            <td style="padding: 12px; text-align: center; font-weight: 600;">${item.quantidade}</td>
            <td style="padding: 12px; text-align: right;">R$ ${item.preco.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
            <td style="padding: 12px; text-align: right; font-weight: 700; color: #059669;">R$ ${item.total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
            <td style="padding: 12px; text-align: center;">
                <button type="button" onclick="removerItemDAV('${item.codigo}')" class="btn-remove">‚ùå</button>
            </td>
        </tr>
    `).join('');
    
    const totalGeral = itensDAV.reduce((sum, item) => sum + item.total, 0);
    document.getElementById('dav-total-geral').textContent = 'R$ ' + totalGeral.toLocaleString('pt-BR', {minimumFractionDigits: 2});
}

function finalizarDAV(event) {
    event.preventDefault();
    
    if (itensDAV.length === 0) {
        alert('‚ö†Ô∏è Adicione pelo menos um produto!');
        return;
    }
    
    const cliente = document.getElementById('dav-cliente').value;
    const representante = document.getElementById('dav-representante').value;
    const pagamento = document.getElementById('dav-pagamento').value;
    const obs = document.getElementById('dav-obs').value;
    const totalGeral = itensDAV.reduce((sum, item) => sum + item.total, 0);
    
    const numeroDAV = 'DAV-' + new Date().getTime();
    const dataEmissao = new Date().toLocaleString('pt-BR');
    
    davAtual = {
        numero: numeroDAV,
        data: new Date().toISOString().split('T')[0],
        dataEmissao: dataEmissao,
        cliente: cliente,
        representante: representante,
        itens: [...itensDAV],
        total: totalGeral,
        pagamento: pagamento,
        observacoes: obs,
        status: 'Emitido'
    };
    
    historicoDAVs.unshift(davAtual);
    salvarDados();
    
    let detalhesItens = itensDAV.map(item => 
        `${item.nome}\nQtd: ${item.quantidade} x R$ ${item.preco.toLocaleString('pt-BR', {minimumFractionDigits: 2})} = R$ ${item.total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`
    ).join('\n\n');
    
    const textoDAV = 
        `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n` +
        `   PROHOSPITALAR - DAV\n` +
        `   Documento Auxiliar de Venda\n` +
        `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n` +
        `üìÑ N√∫mero: ${numeroDAV}\n` +
        `üìÖ Data: ${dataEmissao}\n\n` +
        `üè• Cliente: ${cliente}\n` +
        `üë®‚Äçüíº Representante: ${representante}\n\n` +
        `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n` +
        `ITENS DO PEDIDO:\n` +
        `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n` +
        `${detalhesItens}\n\n` +
        `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n` +
        `üí∞ TOTAL: R$ ${totalGeral.toLocaleString('pt-BR', {minimumFractionDigits: 2})}\n` +
        `üí≥ Pagamento: ${pagamento}\n` +
        `${obs ? '\nüìù Observa√ß√µes:\n' + obs + '\n' : ''}` +
        `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
    
    document.getElementById('dav-gerado-conteudo').textContent = textoDAV;
    closeModal('modalDAV');
    document.getElementById('modalDAVGerado').style.display = 'block';
    document.getElementById('formDAV').reset();
    itensDAV = [];
}

function imprimirDAV() {
    if (!davAtual) return;
    const conteudo = document.getElementById('dav-gerado-conteudo').textContent;
    const janela = window.open('', '', 'width=800,height=600');
    janela.document.write('<html><head><title>DAV - ' + davAtual.numero + '</title>');
    janela.document.write('<style>body{font-family:monospace;padding:20px;white-space:pre-wrap;}</style></head><body>');
    janela.document.write(conteudo);
    janela.document.write('</body></html>');
    janela.document.close();
    janela.print();
}

function baixarDAVPDF() {
    alert('üìÑ Funcionalidade de PDF em desenvolvimento!\n\nUse "Imprimir" e salve como PDF.');
}

function enviarDAVEmail() {
    const email = prompt('üìß Digite o email:');
    if (email) alert('‚úÖ Email enviado para: ' + email + '\n\n(Funcionalidade simulada)');
}

function enviarDAVWhatsApp() {
    if (!davAtual) return;
    const texto = encodeURIComponent(document.getElementById('dav-gerado-conteudo').textContent);
    window.open(`https://wa.me/?text=${texto}`, '_blank');
}

function visualizarDAV(numeroDAV) {
    davAtual = historicoDAVs.find(d => d.numero === numeroDAV);
    if (!davAtual) return;
    
    let detalhes = davAtual.itens.map(item => 
        `${item.nome}\nQtd: ${item.quantidade} x R$ ${item.preco.toLocaleString('pt-BR', {minimumFractionDigits: 2})} = R$ ${item.total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`
    ).join('\n\n');
    
    const texto = 
        `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n` +
        `   PROHOSPITALAR - DAV\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n` +
        `üìÑ ${davAtual.numero}\nüìÖ ${davAtual.dataEmissao}\n\n` +
        `üè• ${davAtual.cliente}\nüë®‚Äçüíº ${davAtual.representante}\n\n` +
        `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nITENS:\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n${detalhes}\n\n` +
        `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüí∞ TOTAL: R$ ${davAtual.total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}\n` +
        `üí≥ ${davAtual.pagamento}\n${davAtual.observacoes ? '\nüìù ' + davAtual.observacoes : ''}`;
    
    document.getElementById('dav-gerado-conteudo').textContent = texto;
    document.getElementById('modalDAVGerado').style.display = 'block';
}

function reimprimirDAV(numeroDAV) {
    visualizarDAV(numeroDAV);
    setTimeout(() => imprimirDAV(), 500);
}

function deletarDAV(numeroDAV) {
    if (confirm('‚ö†Ô∏è Deletar DAV ' + numeroDAV + '?')) {
        historicoDAVs = historicoDAVs.filter(d => d.numero !== numeroDAV);
        salvarDados();
        alert('‚úÖ DAV deletado!');
        renderHistoricoDAVs();
    }
}
    // ========================================
// PARTE B - CRUD REPRESENTANTES E FORNECEDORES
// Cole DENTRO do <script>, depois das fun√ß√µes de DAV
// ========================================

// ========================================
// REPRESENTANTES - CRUD COMPLETO
// ========================================

function salvarRepresentante(event) {
    event.preventDefault();
    
    const idEdit = document.getElementById('representante-id-edit').value;
    
    const dados = {
        nome: document.getElementById('representante-nome').value,
        cpf: document.getElementById('representante-cpf').value,
        telefone: document.getElementById('representante-telefone').value,
        email: document.getElementById('representante-email').value,
        regiao: document.getElementById('representante-regiao').value,
        meta: parseFloat(document.getElementById('representante-meta').value),
        comissao: parseFloat(document.getElementById('representante-comissao').value),
        observacoes: document.getElementById('representante-obs').value
    };
    
    if (idEdit) {
        // EDITAR
        const index = representantes.findIndex(r => r.id == idEdit);
        if (index !== -1) {
            representantes[index] = {
                ...representantes[index],
                ...dados
            };
            alert('‚úÖ Representante atualizado com sucesso!');
        }
    } else {
        // NOVO
        const novoRepresentante = {
            id: representantes.length > 0 ? Math.max(...representantes.map(r => r.id)) + 1 : 1,
            ...dados,
            vendasMes: 0,
            performance: '0%',
            status: 'Ativo'
        };
        representantes.push(novoRepresentante);
        alert('‚úÖ Representante cadastrado com sucesso!');
    }
    
    salvarDados();
    closeModal('modalRepresentante');
    document.getElementById('formRepresentante').reset();
    showTab('vendedores');
}

function editarRepresentante(id) {
    const rep = representantes.find(r => r.id === id);
    if (!rep) return;
    
    document.getElementById('modalRepresentante').style.display = 'block';
    document.getElementById('titulo-modal-representante').textContent = '‚úèÔ∏è Editar Representante';
    document.getElementById('representante-id-edit').value = rep.id;
    document.getElementById('representante-nome').value = rep.nome;
    document.getElementById('representante-cpf').value = rep.cpf || '';
    document.getElementById('representante-telefone').value = rep.telefone || '';
    document.getElementById('representante-email').value = rep.email || '';
    document.getElementById('representante-regiao').value = rep.regiao;
    document.getElementById('representante-meta').value = rep.meta || 0;
    document.getElementById('representante-comissao').value = rep.comissao || 5;
    document.getElementById('representante-obs').value = rep.observacoes || '';
}

function deletarRepresentante(id) {
    const rep = representantes.find(r => r.id === id);
    if (!rep) return;
    
    // Verificar se tem vendas associadas
    const vendasAssociadas = vendas.filter(v => v.representante === rep.nome).length;
    
    if (vendasAssociadas > 0) {
        if (!confirm(`‚ö†Ô∏è ATEN√á√ÉO!\n\nEste representante tem ${vendasAssociadas} venda(s) associada(s).\n\nDeseja realmente deletar?\n\nAs vendas n√£o ser√£o deletadas, apenas o representante ser√° removido.`)) {
            return;
        }
    } else {
        if (!confirm(`‚ö†Ô∏è Deletar o representante "${rep.nome}"?`)) {
            return;
        }
    }
    
    representantes = representantes.filter(r => r.id !== id);
    salvarDados();
    alert('‚úÖ Representante deletado com sucesso!');
    renderRepresentantes();
    atualizarContadores();
}

function abrirModalRepresentante() {
    document.getElementById('modalRepresentante').style.display = 'block';
    document.getElementById('titulo-modal-representante').textContent = 'üë®‚Äçüíº Novo Representante';
    document.getElementById('representante-id-edit').value = '';
    document.getElementById('formRepresentante').reset();
}

// ========================================
// FORNECEDORES - CRUD COMPLETO
// ========================================

function salvarFornecedor(event) {
    event.preventDefault();
    
    const idEdit = document.getElementById('fornecedor-id-edit').value;
    
    const dados = {
        nome: document.getElementById('fornecedor-nome').value,
        cnpj: document.getElementById('fornecedor-cnpj').value,
        ie: document.getElementById('fornecedor-ie').value,
        telefone: document.getElementById('fornecedor-telefone').value,
        email: document.getElementById('fornecedor-email').value,
        especialidade: document.getElementById('fornecedor-especialidade').value,
        cidade: document.getElementById('fornecedor-cidade').value,
        estado: document.getElementById('fornecedor-estado').value,
        observacoes: document.getElementById('fornecedor-obs').value
    };
    
    if (idEdit) {
        // EDITAR
        const index = fornecedores.findIndex(f => f.id == idEdit);
        if (index !== -1) {
            fornecedores[index] = {
                ...fornecedores[index],
                ...dados
            };
            alert('‚úÖ Fornecedor atualizado com sucesso!');
        }
    } else {
        // NOVO
        const novoFornecedor = {
            id: fornecedores.length > 0 ? Math.max(...fornecedores.map(f => f.id)) + 1 : 1,
            ...dados,
            status: 'Ativo'
        };
        fornecedores.push(novoFornecedor);
        alert('‚úÖ Fornecedor cadastrado com sucesso!');
    }
    
    salvarDados();
    closeModal('modalFornecedor');
    document.getElementById('formFornecedor').reset();
    showTab('fornecedores');
}

function editarFornecedor(id) {
    const forn = fornecedores.find(f => f.id === id);
    if (!forn) return;
    
    document.getElementById('modalFornecedor').style.display = 'block';
    document.getElementById('titulo-modal-fornecedor').textContent = '‚úèÔ∏è Editar Fornecedor';
    document.getElementById('fornecedor-id-edit').value = forn.id;
    document.getElementById('fornecedor-nome').value = forn.nome;
    document.getElementById('fornecedor-cnpj').value = forn.cnpj;
    document.getElementById('fornecedor-ie').value = forn.ie || '';
    document.getElementById('fornecedor-telefone').value = forn.telefone || '';
    document.getElementById('fornecedor-email').value = forn.email || '';
    document.getElementById('fornecedor-especialidade').value = forn.especialidade;
    document.getElementById('fornecedor-cidade').value = forn.cidade || '';
    document.getElementById('fornecedor-estado').value = forn.estado || '';
    document.getElementById('fornecedor-obs').value = forn.observacoes || '';
}

function deletarFornecedor(id) {
    const forn = fornecedores.find(f => f.id === id);
    if (!forn) return;
    
    if (!confirm(`‚ö†Ô∏è Deletar o fornecedor "${forn.nome}"?`)) {
        return;
    }
    
    fornecedores = fornecedores.filter(f => f.id !== id);
    salvarDados();
    alert('‚úÖ Fornecedor deletado com sucesso!');
    renderFornecedores();
    atualizarContadores();
}

function abrirModalFornecedor() {
    document.getElementById('modalFornecedor').style.display = 'block';
    document.getElementById('titulo-modal-fornecedor').textContent = 'üè≠ Novo Fornecedor';
    document.getElementById('fornecedor-id-edit').value = '';
    document.getElementById('formFornecedor').reset();
}

// ========================================
// ATUALIZAR RENDERIZA√á√ïES (SUBSTITUIR)
// ========================================

// SUBSTITUIR a fun√ß√£o renderRepresentantes() existente por esta:
function renderRepresentantes() {
    const tbody = document.getElementById('lista-representantes');
    if (!tbody) return;
    
    if (representantes.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-gray-500">Nenhum representante cadastrado. <button onclick="abrirModalRepresentante()" class="text-green-600 font-semibold ml-2">Cadastrar primeiro representante</button></td></tr>';
        return;
    }
    
    tbody.innerHTML = representantes.map(rep => {
        const vendasRep = vendas.filter(v => v.representante === rep.nome).reduce((sum, v) => sum + v.valor, 0);
        const metaAtingida = rep.meta > 0 ? ((vendasRep / rep.meta) * 100).toFixed(0) : 0;
        const corPerformance = metaAtingida >= 100 ? 'text-green-600' : metaAtingida >= 80 ? 'text-blue-600' : 'text-orange-600';
        
        return `
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4">
                    <div class="font-medium">${rep.nome}</div>
                    <div class="text-xs text-gray-500">${rep.email || 'Sem email'}</div>
                </td>
                <td class="px-6 py-4 text-sm">${rep.regiao}</td>
                <td class="px-6 py-4">
                    <div class="font-semibold ${corPerformance}">R$ ${vendasRep.toLocaleString('pt-BR')}</div>
                    <div class="text-xs text-gray-500">Meta: R$ ${(rep.meta || 0).toLocaleString('pt-BR')} (${metaAtingida}%)</div>
                </td>
                <td class="px-6 py-4">
                    <button onclick="editarRepresentante(${rep.id})" class="btn-edit">‚úèÔ∏è Editar</button>
                    <button onclick="deletarRepresentante(${rep.id})" class="btn-delete">üóëÔ∏è Deletar</button>
                </td>
            </tr>
        `;
    }).join('');
}

// SUBSTITUIR a fun√ß√£o renderFornecedores() existente por esta:
function renderFornecedores() {
    const tbody = document.getElementById('lista-fornecedores');
    if (!tbody) return;
    
    if (fornecedores.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center text-gray-500">Nenhum fornecedor cadastrado. <button onclick="abrirModalFornecedor()" class="text-indigo-600 font-semibold ml-2">Cadastrar primeiro fornecedor</button></td></tr>';
        return;
    }
    
    tbody.innerHTML = fornecedores.map(forn => `
        <tr class="hover:bg-gray-50">
            <td class="px-6 py-4">
                <div class="font-medium">${forn.nome}</div>
                <div class="text-xs text-gray-500">${forn.email || 'Sem email'}</div>
            </td>
            <td class="px-6 py-4 text-sm">${forn.cnpj}</td>
            <td class="px-6 py-4 text-sm">
                <div>${forn.especialidade}</div>
                <div class="text-xs text-gray-500">${forn.cidade || ''} - ${forn.estado || ''}</div>
            </td>
            <td class="px-6 py-4">
                <button onclick="editarFornecedor(${forn.id})" class="btn-edit">‚úèÔ∏è Editar</button>
                <button onclick="deletarFornecedor(${forn.id})" class="btn-delete">üóëÔ∏è Deletar</button>
            </td>
        </tr>
    `).join('');
}

// ========================================
// ATUALIZAR openModal() - ADICIONAR CASOS
// ========================================

// SUBSTITUIR a fun√ß√£o openModal() adicionando estes casos:
// Procure a fun√ß√£o openModal() existente e adicione estes casos no final:

// Na fun√ß√£o openModal(), adicionar:
/*
} else if (tipo === 'representante') {
    abrirModalRepresentante();
} else if (tipo === 'fornecedor') {
    abrirModalFornecedor();
}
*/

// ========================================
// FIM DA PARTE B
// ========================================

console.log('‚úÖ CRUD Representantes e Fornecedores carregado!');
    // ========================================
// PARTE C - ATUALIZA√á√ïES E INTEGRA√á√ïES
// ========================================

// ========================================
// 1Ô∏è‚É£ ADICIONAR NOS BOT√ïES R√ÅPIDOS DA SIDEBAR
// ========================================

// PROCURE no HTML a se√ß√£o "A√ß√µes R√°pidas" e ADICIONE estes bot√µes:

/*
<button onclick="openModal('representante')" class="w-full bg-yellow-50 text-yellow-700 px-3 py-2 rounded-lg text-sm hover:bg-yellow-100 font-medium">üë®‚Äçüíº Novo Representante</button>
<button onclick="openModal('fornecedor')" class="w-full bg-indigo-50 text-indigo-700 px-3 py-2 rounded-lg text-sm hover:bg-indigo-100 font-medium">üè≠ Novo Fornecedor</button>
*/

// ========================================
// 2Ô∏è‚É£ ATUALIZAR A FUN√á√ÉO openModal()
// ========================================

// SUBSTITUIR a fun√ß√£o openModal() COMPLETA por esta:

function openModal(tipo) {
    if (tipo === 'venda') {
        document.getElementById('modalVenda').style.display = 'block';
        document.getElementById('titulo-modal-venda').textContent = 'üí∞ Nova Venda';
        document.getElementById('venda-id-edit').value = '';
        popularSelectsVenda();
        document.getElementById('formVenda').reset();
    } else if (tipo === 'cliente') {
        document.getElementById('modalCliente').style.display = 'block';
        document.getElementById('titulo-modal-cliente').textContent = 'üè• Novo Cliente';
        document.getElementById('cliente-id-edit').value = '';
        document.getElementById('formCliente').reset();
    } else if (tipo === 'produto') {
        document.getElementById('modalProduto').style.display = 'block';
        document.getElementById('titulo-modal-produto').textContent = 'ü©∫ Novo Produto';
        document.getElementById('produto-codigo-edit').value = '';
        document.getElementById('formProduto').reset();
    } else if (tipo === 'dav') {
        document.getElementById('modalDAV').style.display = 'block';
        popularSelectsDAV();
        itensDAV = [];
        atualizarTabelaDAV();
    } else if (tipo === 'representante') {
        abrirModalRepresentante();
    } else if (tipo === 'fornecedor') {
        abrirModalFornecedor();
    }
}

// ========================================
// 3Ô∏è‚É£ ATUALIZAR showTab() PARA INCLUIR VENDEDORES/FORNECEDORES
// ========================================

// SUBSTITUIR a fun√ß√£o showTab() COMPLETA por esta:

function showTab(tabName) {
    const tabs = ['dashboard', 'vendas', 'contas-receber', 'clientes', 'estoque', 'vendedores', 'fornecedores', 'financeiro', 'historico-davs'];
    
    tabs.forEach(tab => {
        const element = document.getElementById(tab);
        if (element) element.classList.add('hidden');
        
        const tabButton = document.getElementById(`tab-${tab}`);
        if (tabButton) {
            tabButton.classList.remove('active-tab');
            tabButton.classList.add('text-gray-700', 'hover:bg-gray-100');
        }
    });

    const selectedTab = document.getElementById(tabName);
    if (selectedTab) {
        selectedTab.classList.remove('hidden');
        selectedTab.classList.add('fade-in');
    }
    
    const selectedButton = document.getElementById(`tab-${tabName}`);
    if (selectedButton) {
        selectedButton.classList.add('active-tab');
        selectedButton.classList.remove('text-gray-700', 'hover:bg-gray-100');
    }

    // Renderizar conforme a aba
    if (tabName === 'dashboard') initDashboard();
    else if (tabName === 'vendas') renderVendas();
    else if (tabName === 'contas-receber') renderContasReceber();
    else if (tabName === 'clientes') renderClientes();
    else if (tabName === 'estoque') renderProdutos();
    else if (tabName === 'vendedores') renderRepresentantes();
    else if (tabName === 'fornecedores') renderFornecedores();
    else if (tabName === 'financeiro') renderFinanceiro();
    else if (tabName === 'historico-davs') renderHistoricoDAVs();
}

// ========================================
// 4Ô∏è‚É£ ATUALIZAR carregarDadosIniciais()
// ========================================

// SUBSTITUIR a fun√ß√£o carregarDadosIniciais() COMPLETA por esta:

function carregarDadosIniciais() {
    clientes = [
        { id: 1, nome: 'Hospital S√£o Lucas', cnpj: '12.345.678/0001-90', cidade: 'S√£o Paulo', status: 'Ativo' },
        { id: 2, nome: 'Cl√≠nica Santa Maria', cnpj: '23.456.789/0001-01', cidade: 'Rio de Janeiro', status: 'Ativo' }
    ];
    
    produtos = [
        { codigo: 'MC-500', nome: 'Monitor Card√≠aco', categoria: 'Monitoramento', quantidade: 12, custo: 30000, precoVenda: 45000, estoqueMinimo: 5 },
        { codigo: 'US-300', nome: 'Ultrassom Port√°til', categoria: 'Diagn√≥stico', quantidade: 3, custo: 50000, precoVenda: 78000, estoqueMinimo: 5 },
        { codigo: 'RX-700', nome: 'Raio-X Digital', categoria: 'Radiologia', quantidade: 2, custo: 80000, precoVenda: 125000, estoqueMinimo: 2 }
    ];
    
    representantes = [
        { 
            id: 1, 
            nome: 'Ana Silva', 
            cpf: '123.456.789-00',
            telefone: '(11) 99999-1111',
            email: 'ana.silva@prohospitalar.com',
            regiao: 'Sudeste', 
            meta: 200000,
            comissao: 5,
            vendasMes: 0, 
            performance: '0%',
            status: 'Ativo'
        },
        { 
            id: 2, 
            nome: 'Carlos Mendes', 
            cpf: '987.654.321-00',
            telefone: '(41) 99999-2222',
            email: 'carlos.mendes@prohospitalar.com',
            regiao: 'Sul', 
            meta: 180000,
            comissao: 5,
            vendasMes: 0, 
            performance: '0%',
            status: 'Ativo'
        }
    ];
    
    fornecedores = [
        { 
            id: 1, 
            nome: 'MedTech Equipamentos Ltda', 
            cnpj: '56.789.012/0001-34',
            ie: '123.456.789.012',
            telefone: '(11) 3333-3333',
            email: 'contato@medtech.com.br',
            especialidade: 'Equipamentos de Diagn√≥stico',
            cidade: 'S√£o Paulo',
            estado: 'SP',
            status: 'Ativo' 
        },
        { 
            id: 2, 
            nome: 'HospitalPro Ind√∫stria', 
            cnpj: '78.901.234/0001-56',
            ie: '987.654.321.098',
            telefone: '(21) 2222-2222',
            email: 'vendas@hospitalpro.com.br',
            especialidade: 'Equipamentos de Monitoramento',
            cidade: 'Rio de Janeiro',
            estado: 'RJ',
            status: 'Ativo' 
        }
    ];
    
    vendas = [];
    contasReceber = [];
    transacoes = [];
    historicoDAVs = [];
}

// ========================================
// 5Ô∏è‚É£ ATUALIZAR salvarDados() E carregarDados()
// ========================================

// SUBSTITUIR a fun√ß√£o salvarDados() por esta:

function salvarDados() {
    try {
        const dados = {
            vendas,
            produtos,
            clientes,
            representantes,
            fornecedores,
            transacoes,
            contasReceber,
            historicoDAVs,
            ultimoBackup: new Date().toLocaleString('pt-BR')
        };
        localStorage.setItem('prohospitalar_dados', JSON.stringify(dados));
        document.getElementById('ultimo-backup').textContent = 'Agora mesmo';
        return true;
    } catch (e) {
        console.error('Erro ao salvar dados:', e);
        return false;
    }
}

// SUBSTITUIR a fun√ß√£o carregarDados() por esta:

function carregarDados() {
    try {
        const dadosSalvos = localStorage.getItem('prohospitalar_dados');
        if (dadosSalvos) {
            const dados = JSON.parse(dadosSalvos);
            vendas = dados.vendas || [];
            produtos = dados.produtos || [];
            clientes = dados.clientes || [];
            representantes = dados.representantes || [];
            fornecedores = dados.fornecedores || [];
            transacoes = dados.transacoes || [];
            contasReceber = dados.contasReceber || [];
            historicoDAVs = dados.historicoDAVs || [];
            
            if (dados.ultimoBackup) {
                document.getElementById('ultimo-backup').textContent = dados.ultimoBackup;
            }
            
            console.log('‚úÖ Dados carregados do backup!');
            return true;
        } else {
            carregarDadosIniciais();
            console.log('‚úÖ Dados iniciais carregados!');
            return false;
        }
    } catch (e) {
        console.error('Erro ao carregar dados:', e);
        carregarDadosIniciais();
        return false;
    }
}

// ========================================
// 6Ô∏è‚É£ ADICIONAR TABS NA SIDEBAR (HTML)
// ========================================

// PROCURE na sidebar os bot√µes de navega√ß√£o e ADICIONE (se n√£o tiver):

/*
<button onclick="showTab('vendedores')" id="tab-vendedores" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
    <span class="text-xl">üë®‚Äçüíº</span>
    <div class="flex-1 text-left"><span class="font-medium">Representantes</span></div>
</button>

<button onclick="showTab('fornecedores')" id="tab-fornecedores" class="w-full flex items-center space-x-4 px-4 py-3 rounded-lg transition-all text-gray-700 hover:bg-gray-100">
    <span class="text-xl">üè≠</span>
    <div class="flex-1 text-left"><span class="font-medium">Fornecedores</span></div>
</button>
*/

// ========================================
// 7Ô∏è‚É£ ADICIONAR DIVS VENDEDORES E FORNECEDORES (HTML)
// ========================================

// PROCURE no HTML as divs de conte√∫do e ADICIONE (se n√£o tiver):

/*
<div id="vendedores" class="hidden">
    <h2 class="text-3xl font-bold mb-6">üë®‚Äçüíº Gest√£o de Representantes</h2>
    <div class="bg-white rounded-xl shadow-premium overflow-hidden">
        <table class="w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Regi√£o</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Vendas</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="lista-representantes"></tbody>
        </table>
    </div>
</div>

<div id="fornecedores" class="hidden">
    <h2 class="text-3xl font-bold mb-6">üè≠ Gest√£o de Fornecedores</h2>
    <div class="bg-white rounded-xl shadow-premium overflow-hidden">
        <table class="w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nome</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">CNPJ</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Especialidade</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="lista-fornecedores"></tbody>
        </table>
    </div>
</div>
*/

// ========================================
// FIM DA PARTE C
// ========================================

console.log('‚úÖ Integra√ß√µes de Representantes e Fornecedores completas!');
    // ========================================
// PARTE 5 DE 5 - EXPORTA√á√ïES E INICIALIZA√á√ÉO
// ========================================

// ========================================
// FUN√á√ïES DE EXPORTA√á√ÉO
// ========================================

function exportarDashboard() {
    const totalVendas = vendas.reduce((sum, v) => sum + v.valor, 0);
    const { totalReceber } = calcularTotaisReceber();
    
    let csv = 'DASHBOARD PROHOSPITALAR\n\n';
    csv += 'RESUMO EXECUTIVO\n';
    csv += `Total de Vendas,R$ ${totalVendas.toLocaleString('pt-BR')}\n`;
    csv += `Total a Receber,R$ ${totalReceber.toLocaleString('pt-BR')}\n`;
    csv += `Clientes Cadastrados,${clientes.length}\n`;
    csv += `Produtos Ativos,${produtos.length}\n`;
    csv += `Produtos com Estoque Baixo,${produtos.filter(p => p.quantidade <= (p.estoqueMinimo || 5)).length}\n`;
    
    baixarCSV(csv, 'dashboard_prohospitalar.csv');
}

function exportarVendas() {
    let csv = 'Data,Cliente,Produto,Quantidade,Valor,Status,Pagamento\n';
    vendas.forEach(v => {
        csv += `${v.data},${v.cliente},${v.produto},${v.quantidade || 1},R$ ${v.valor.toLocaleString('pt-BR')},${v.status},${v.pagamento}\n`;
    });
    baixarCSV(csv, 'vendas_prohospitalar.csv');
}

function exportarContasReceber() {
    let csv = 'Venda,Cliente,Vencimento,Valor,Status\n';
    contasReceber.forEach(c => {
        csv += `#${c.vendaId},${c.cliente},${new Date(c.dataVencimento).toLocaleDateString('pt-BR')},R$ ${c.valor.toLocaleString('pt-BR')},${c.status}\n`;
    });
    baixarCSV(csv, 'contas_receber_prohospitalar.csv');
}

function exportarClientes() {
    let csv = 'Nome,CNPJ,Cidade,Status\n';
    clientes.forEach(c => {
        csv += `${c.nome},${c.cnpj},${c.cidade},${c.status}\n`;
    });
    baixarCSV(csv, 'clientes_prohospitalar.csv');
}

function exportarProdutos() {
    let csv = 'C√≥digo,Nome,Categoria,Quantidade,Custo,Pre√ßo Venda,Estoque M√≠nimo\n';
    produtos.forEach(p => {
        csv += `${p.codigo},${p.nome},${p.categoria},${p.quantidade},R$ ${p.custo.toLocaleString('pt-BR')},R$ ${p.precoVenda.toLocaleString('pt-BR')},${p.estoqueMinimo}\n`;
    });
    baixarCSV(csv, 'produtos_prohospitalar.csv');
}

function exportarRepresentantes() {
    alert('üìÑ Fun√ß√£o em desenvolvimento!');
}

function exportarFornecedores() {
    alert('üìÑ Fun√ß√£o em desenvolvimento!');
}

function exportarFinanceiro() {
    alert('üìÑ Fun√ß√£o em desenvolvimento!');
}

function exportarHistoricoDAVs() {
    alert('üìÑ Fun√ß√£o em desenvolvimento!');
}

function baixarCSV(conteudo, nomeArquivo) {
    const blob = new Blob([conteudo], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', nomeArquivo);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    alert('‚úÖ Arquivo exportado com sucesso!\n\nüìÑ ' + nomeArquivo);
}

// ========================================
// NOTIFICA√á√ïES
// ========================================

function mostrarNotificacoes() {
    const contasPendentes = contasReceber.filter(c => c.status === 'Pendente').length;
    const produtosBaixos = produtos.filter(p => p.quantidade <= (p.estoqueMinimo || 5)).length;
    
    let msg = 'üîî NOTIFICA√á√ïES DO SISTEMA\n\n';
    
    if (contasPendentes > 0) {
        msg += `üíµ ${contasPendentes} conta(s) a receber pendente(s)\n`;
    }
    
    if (produtosBaixos > 0) {
        msg += `‚ö†Ô∏è ${produtosBaixos} produto(s) com estoque baixo\n`;
        const lista = produtos.filter(p => p.quantidade <= (p.estoqueMinimo || 5));
        lista.forEach(p => {
            msg += `   ‚Ä¢ ${p.nome}: ${p.quantidade} unidades\n`;
        });
    }
    
    if (contasPendentes === 0 && produtosBaixos === 0) {
        msg += '‚úÖ Nenhuma notifica√ß√£o pendente!\n\nTudo est√° em ordem! üéâ';
    }
    
    alert(msg);
}

// ========================================
// INICIALIZA√á√ÉO DO SISTEMA
// ========================================

window.onload = function() {
    console.log('üöÄ Iniciando ProHospitalar v5.0...');
    
    // Carregar dados do backup
    carregarDados();
    
    // Inicializar dashboard
    showTab('dashboard');
    
    // Verificar estoque baixo
    verificarEstoqueBaixo();
    
    // Atualizar contadores
    atualizarContadores();
    
    console.log('‚úÖ Sistema iniciado com sucesso!');
    console.log('üìä Vendas:', vendas.length);
    console.log('üè• Clientes:', clientes.length);
    console.log('ü©∫ Produtos:', produtos.length);
    console.log('üíµ Contas a Receber:', contasReceber.length);
};

// ========================================
// FECHAR MODAL AO CLICAR FORA
// ========================================

window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
    }
}

// ========================================
// SALVAR AUTOMATICAMENTE A CADA 30 SEGUNDOS
// ========================================

setInterval(() => {
    salvarDados();
    console.log('üíæ Backup autom√°tico realizado:', new Date().toLocaleString('pt-BR'));
}, 30000); // 30 segundos

console.log('‚úÖ ProHospitalar v5.0 - FASE 1 COMPLETA carregado!');
console.log('üì¶ Funcionalidades implementadas:');
console.log('   ‚úÖ Baixa autom√°tica de estoque');
console.log('   ‚úÖ Contas a Receber');
console.log('   ‚úÖ Backup localStorage autom√°tico');
console.log('   ‚úÖ Exporta√ß√£o de dados (CSV)');
console.log('   ‚úÖ Alertas de estoque baixo');
console.log('   ‚úÖ Dashboard executivo');
</script>
</body>
</html>
